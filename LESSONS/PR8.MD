### ๐ ๐ ๐ ะะฐะฒะธะณะฐัะธั ะฟะพ ะบัััั

| [ะัะตะดัะดััะตะต ะทะฐะฝััะธะต](../LESSONS/LESSON8.MD) | &nbsp; | [ะกะปะตะดัััะตะต ะทะฐะฝััะธะต](../LESSONS/LESSON9.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| ๐ [ะะตะบัะธั โ8](../LESSONS/LESSON8.MD) | ๐ [ะกะพะดะตัะถะฐะฝะธะต](../README.MD) | ๐ป [ะะตะบัะธั โ9](../LESSONS/LESSON9.MD) |
---

# ะัะฐะบัะธัะตัะบะฐั ัะฐะฑะพัะฐ โ8  
## ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัะธััะธะบะธ; ะฐะฝะฐะปะธะท ะฟัะพััะพะณะพ ะฟะปะฐะฝะฐ ะฒัะฟะพะปะฝะตะฝะธั

> **ะฆะตะปั**: ะะฐััะธัััั ะฝะฐัะพะดะธัั ัััะฐัะตะฒััั ััะฐัะธััะธะบั ะฟะพ ัะฐััะพะถะดะตะฝะธั *ยซะัะตะฝะบะฐ ัััะพะบยป* ะธ *ยซะคะฐะบั ัััะพะบยป*, ะฟะพะฝะธะผะฐัั ะปะพะณะธะบั ะฒัะฑะพัะฐ ะฟะปะฐะฝะฐ SQL Serverโะพะผ, ะธ ััััะฐะฝััั ัะทะบะธะต ะผะตััะฐ ะทะฐ 1 ะบะพะผะฐะฝะดั โ `UPDATE STATISTICS`.  
> **ะัะพะดะพะปะถะธัะตะปัะฝะพััั**: 2 ะฐะบะฐะดะตะผะธัะตัะบะธั ัะฐัะฐ  
> **ะะฑะพััะดะพะฒะฐะฝะธะต**: SSMS, SQL Server Developer Edition

---

## ๐ฅ ะจะฐะณ 0. ะกัะฐััะพะฒัะน ัะบัะธะฟั (ะฒัะฟะพะปะฝะธัะต ัะตะปะธะบะพะผ)

```sql
-- ะกะพะทะดะฐัะผ ััะตะฑะฝัั ะะ
DROP DATABASE IF EXISTS StatsLab;
CREATE DATABASE StatsLab;
GO
USE StatsLab;
GO
-- ะขะฐะฑะปะธัะฐ ะะะ ะฟะตัะฒะธัะฝะพะณะพ ะบะปััะฐ โ ะบััะฐ (HEAP)
CREATE TABLE Orders (
    OrderID int IDENTITY(1,1),  -- โ ะะะข PK
    CustomerID int,
    Amount decimal(10,2),
    Status char(10)
);
GO

-- 10 000 ยซััะฐัััยป ะทะฐะบะฐะทะพะฒ
INSERT INTO Orders (CustomerID, Amount, Status)
SELECT TOP 10000 
    ABS(CHECKSUM(NEWID())) % 100 + 1,
    CAST(RAND(CHECKSUM(NEWID())) * 1000 AS decimal(10,2)),
    'active'
FROM master.dbo.spt_values a, master.dbo.spt_values b;
GO

-- ะะฝะดะตะบั ะฟะพ Status (ะฝะต ะฟะพะบััะฒะฐััะธะน!)
CREATE NONCLUSTERED INDEX IX_Orders_Status ON Orders(Status);
GO

-- ะัะบะปััะฐะตะผ ะฐะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะะ ะฒััะฐะฒะบะธ ะฝะพะฒัั
ALTER DATABASE StatsLab SET AUTO_UPDATE_STATISTICS OFF;
GO

-- 5 000 ยซะฝะพะฒััยป ะทะฐะบะฐะทะพะฒ
INSERT INTO Orders (CustomerID, Amount, Status)
SELECT TOP 5000 
    100 + ABS(CHECKSUM(NEWID())) % 50,
    CAST(RAND(CHECKSUM(NEWID())) * 200 AS decimal(10,2)),
    'new'
FROM master.dbo.spt_values a, master.dbo.spt_values b;
GO
```

---

## ๐ ะจะฐะณ 0.5. ะัะพะฒะตัะบะฐ ััะปะพะฒะธะน ัะบัะฟะตัะธะผะตะฝัะฐ (ะพะฑัะทะฐัะตะปัะฝะพ!)

ะัะฟะพะปะฝะธัะต ะธ ัะฑะตะดะธัะตัั, ััะพ ัะตะทัะปััะฐัั **ัะพะฒะฟะฐะดะฐัั ั ะพะถะธะดะฐะตะผัะผะธ**:

#### 1. ะขะฐะฑะปะธัะฐ โ ะบััะฐ?
```sql
SELECT i.type_desc 
FROM sys.indexes i 
WHERE i.object_id = OBJECT_ID('Orders') AND i.index_id = 0;
```
โ **ะะถะธะดะฐะตะผะพ**: Type_desc = `HEAP`

#### 2. ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะพัะบะปััะตะฝะพ?
```sql
SELECT is_auto_update_stats_on 
FROM sys.databases 
WHERE name = 'StatsLab';
```
โ **ะะถะธะดะฐะตะผะพ**: `0`

#### 3. ะ ััะฐัะธััะธะบะต ะฝะตั `'new'`?
```sql
DBCC SHOW_STATISTICS ('Orders', 'IX_Orders_Status');
```
โ **ะะถะธะดะฐะตะผะพ**: ะฒะพ ะฒะบะปะฐะดะบะต **ยซะะธััะพะณัะฐะผะผะฐยป** โ ัะพะปัะบะพ `RANGE_HI_KEY = 'active'`.

> โ๏ธ **ะัะปะธ `'new'` ะตััั โ ะฟะตัะตัะพะทะดะฐะนัะต ะะ!** ะะพััะดะพะบ ะบัะธัะธัะตะฝ:  
> `INSERT 'active'` โ `CREATE INDEX` โ `SET AUTO_UPDATE OFF` โ `INSERT 'new'`.

![8_1.png](8_1.png)

---

## ๐ ะะฐะดะฐะฝะธะต 1. ะะธะฐะณะฝะพััะธะบะฐ: ะฝะฐะนะดะธัะต ัะฐััะพะถะดะตะฝะธะต ะัะตะฝะบะฐ/ะคะฐะบั

1. ะะบะปััะธัะต **`Ctrl + M`** (ะะตะนััะฒะธัะตะปัะฝัะน ะฟะปะฐะฝ ะฒัะฟะพะปะฝะตะฝะธั).  
2. ะัะฟะพะปะฝะธัะต:
   ```sql
   SET STATISTICS IO ON;
   SELECT OrderID, Amount FROM Orders WHERE Status = 'new';
   ```

3. ะ ยซะะปะฐะฝะต ะฒัะฟะพะปะฝะตะฝะธัยป ะฝะฐะนะดะธัะต:  
   - `ะะฐััััะฝะพะต ัะธัะปะพ ัััะพะบ ะดะปั ะฒัะตั ะฒัะฟะพะปะฝะตะฝะธะน` (Estimated Number of Rows),  
   - `ะคะฐะบัะธัะตัะบะพะต ัะธัะปะพ ัััะพะบ ะดะปั ะฒัะตั ะฒัะฟะพะปะฝะตะฝะธะน` (Actual Number of Rows).

4. ะ ยซะกะพะพะฑัะตะฝะธััยป ะทะฐะฟะธัะธัะต:  
   - `ะปะพะณะธัะตัะบะธะต ะพะฟะตัะฐัะธะธ ััะตะฝะธั`.
   - `ะทะฐััะฐัะตะฝะฝะพะต ะฒัะตะผั`

5. ะ ะพััััะต ัะบะฐะถะธัะต:  
   - ะขะธะฟ ะพะฟะตัะฐัะพัะฐ (ะฝะฐะฟัะธะผะตั, `ะัะพัะผะพัั ัััะพะบ ัะฐะฑะปะธัั`),  
   - ะะพัะตะผั SQL Server ะฒัะฑัะฐะป ะธะผะตะฝะฝะพ ะตะณะพ?

![8_2.png](8_2.png)

---

## ๐ ะกะฟัะฐะฒะบะฐ: ะัะบัะดะฐ ะฑะตััััั ะดัะพะฑะฝะพะต ัะธัะปะพ 122.474? 

> ๐ก **SQL Server ะฝะต ยซััะธัะฐะตัยป ัััะพะบะธ โ ะพะฝ *ะพัะตะฝะธะฒะฐะตั* ะธั ะฟะพ ััะฐัะธััะธะบะต.**  
> ะัะปะธ ะทะฝะฐัะตะฝะธะต ะพััััััะฒัะตั ะฒ ะณะธััะพะณัะฐะผะผะต, ะพะฝ **ะฝะต ะณะฐะดะฐะตั**, ะฐ ะธัะฟะพะปัะทัะตั **ะผะฐัะตะผะฐัะธัะตัะบะธะต ะผะพะดะตะปะธ**. ะะพั ะบะฐะบ ััะพ ัะฐะฑะพัะฐะตั.

---

### 1. ะะพัะตะผั `'new'` ะพััััััะฒัะตั ะฒ ะณะธััะพะณัะฐะผะผะต?

- ะั ะพัะบะปััะธะปะธ `AUTO_UPDATE_STATISTICS`,  
- ะััะฐะฒะธะปะธ 5 000 ัััะพะบ ัะพ `'new'` **ะฟะพัะปะต** ัะพะทะดะฐะฝะธั ะธะฝะดะตะบัะฐ,  
- โ ะกัะฐัะธััะธะบะฐ ะพััะฐะปะฐัั ั ะดะฐะฝะฝัะผะธ ัะพะปัะบะพ ะดะปั `'active'`.

---

### 2. ะงัะพ ะดะตะปะฐะตั ะพะฟัะธะผะธะทะฐัะพั, ะบะพะณะดะฐ ะทะฝะฐัะตะฝะธะต ะฝะต ะฝะฐะนะดะตะฝะพ?

ะะฝ **ะฝะต ะฟะฐะฝะธะบัะตั** โ ะพะฝ ะธัะฟะพะปัะทัะตั **ะฒะตะบัะพั ะฟะปะพัะฝะพััะธ (Density Vector)** ะธ **ัะฒัะธััะธะบะธ ะพัะตะฝัะธะบะฐ ะบะฐัะดะธะฝะฐะปัะฝะพััะธ (Cardinality Estimator)**.

#### ๐น ะะปะพัะฝะพััั (Density)
- ะะปะพัะฝะพััั = `1 / ัะธัะปะพ ัะฝะธะบะฐะปัะฝัั ะทะฝะฐัะตะฝะธะน`,  
- ะะพ ะฒััะฐะฒะบะธ `'new'`: ัะฝะธะบะฐะปัะฝัั ะทะฝะฐัะตะฝะธะน = 1 (`'active'`) โ ะฟะปะพัะฝะพััั = **1.0**,  
- ะะพ ะฟะพัะปะต ะฒััะฐะฒะบะธ (ัะพัั ััะฐัะธััะธะบะฐ ะฝะต ะพะฑะฝะพะฒะปะตะฝะฐ) SQL Server **ะบะพััะตะบัะธััะตั** ะฟะปะพัะฝะพััั ะฟะพ ัะฐะบัะธัะตัะบะพะผั ัะธัะปั ัััะพะบ.

#### ๐น ะญะฒัะธััะธะบะฐ ะดะปั ะฝะพะฒัั ะทะฝะฐัะตะฝะธะน
ะ SQL Server 2016+ (ะฝะพะฒัะน CE) ะธัะฟะพะปัะทัะตััั ัะพัะผัะปะฐ:  
```
ะัะตะฝะบะฐ = SQRT(ะะฑัะตะต ัะธัะปะพ ัััะพะบ)  
       = SQRT(15 000) โ 122.47 โ **ัะพะฒะฟะฐะดะฐะตั ั ะฒะฐัะธะผ ัะตะทัะปััะฐัะพะผ!**
```

โ **ะัะพะฒะตัะบะฐ**:  
```sql
SELECT SQRT(15000.0) AS Test;  -- ะะตะทัะปััะฐั: 122.474487...
```

>  SQL Server ัะณะฐะดัะฒะฐะตั ะบะพะปะธัะตััะฒะพ ัััะพะบ ะดะปั ะทะฝะฐัะตะฝะธั 'new', ะฟะพัะพะผั ััะพ ะพะฝะพ ะฝะต ะฑัะปะพ ัััะตะฝะพ ะฒ ััะฐัะธััะธะบะต.
ะัะพะฑะฝะพะต ัะธัะปะพ ะฒะพะทะฝะธะบะฐะตั ะธะท-ะทะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัััะตะดะฝะตะฝะฝัั ะธ ะฒะตัะพััะฝะพััะฝัั ะผะฐัะตะผะฐัะธัะตัะบะธั ะผะพะดะตะปะตะน,
ะฐ ะฝะต ัะตะฐะปัะฝะพะณะพ ะฟะพะดััะตัะฐ ัััะพะบ.

---

## ๐ ะะฐะดะฐะฝะธะต 2. ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัะธััะธะบะธ โ ะบะฐะบ ะผะตะฝัะตััั ะฟะปะฐะฝ?

1. ะะฑะฝะพะฒะธัะต ััะฐัะธััะธะบั:
   ```sql
   UPDATE STATISTICS Orders IX_Orders_Status;
   ```

2. ะะพะฒัะพัะธัะต ะทะฐะฟัะพั ะธะท ะะฐะดะฐะฝะธั 1.  
3. ะกัะฐะฒะฝะธัะต:  
   - `ะัะตะฝะบะฐ ัััะพะบ` ะดะพ/ะฟะพัะปะต,  
   - `ะปะพะณะธัะตัะบะธะต ะพะฟะตัะฐัะธะธ ััะตะฝะธั`, 
   - `ะทะฐััะฐัะตะฝะฝะพะต ะฒัะตะผั`,
   - `ะขะธะฟ ะพะฟะตัะฐัะพัะฐ`.

> ๐ก **ะะพะดัะบะฐะทะบะฐ**: ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั `ะคะฐะบัะธัะตัะบะพะต ัะธัะปะพ ัััะพะบ ะดะปั ะฒัะตั ะฒัะฟะพะปะฝะตะฝะธะน` ะดะพะปะถะฝะฐ ััะฐัั ะฑะปะธะทะบะฐ ะบ `ะะฐััััะฝะพะต ัะธัะปะพ ัััะพะบ ะดะปั ะฒัะตั ะฒัะฟะพะปะฝะตะฝะธะน`.

![8_3.png](8_3.png)

4. ะ ะพััััะต **ะทะฐะฟะพะปะฝะธัะต ัะฐะฑะปะธัั**:

| ะะพะบะฐะทะฐัะตะปั | ะะพ ะพะฑะฝะพะฒะปะตะฝะธั | ะะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั |
|-----------|---------------|------------------|
| **ะะฐััััะฝะพะต ัะธัะปะพ ัััะพะบ ะดะปั ะฒัะตั ะฒัะฟะพะปะฝะตะฝะธะน** | ... | ... |
| **ะคะฐะบัะธัะตัะบะพะต ัะธัะปะพ ัััะพะบ ะดะปั ะฒัะตั ะฒัะฟะพะปะฝะตะฝะธะน** | ... | ... |
| **ะปะพะณะธัะตัะบะธะต ะพะฟะตัะฐัะธะธ ััะตะฝะธั** | ... | ... |
| **ะทะฐััะฐัะตะฝะฝะพะต ะฒัะตะผั** | ... | ... |
| **ะขะธะฟ ะพะฟะตัะฐัะพัะฐ** | ... | ... |

> ๐ก **ะะถะธะดะฐะตะผะพ**:  
> - `ะะฐััััะฝะพะต ัะธัะปะพ ัััะพะบ` = **5 000**,  
> - ะะปะฐะฝ ะผะพะถะตั ะพััะฐัััั `ะัะพัะผะพัั ัััะพะบ ัะฐะฑะปะธัั` (ะตัะปะธ 5 000 ัััะพะบ โ ะฒัั ะตัั ะผะฐะปะพ ะดะปั 15 000).



---

## ๐ ะะฐะดะฐะฝะธะต 3. ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝัะน Key Lookup (ะฝะฐ ะฝะพะฒะพะน ะะ)

> ๐ก **ะ ะฟัะตะดัะดััะตะน ัะฐะฑะปะธัะต `Orders` Key Lookup ะฝะต ะฟะพัะฒะปัะปัั, ะฟะพัะพะผั ััะพ `SELECT *` ะฝะต ััะตะฑัะตั ะพะฑัะฐัะตะฝะธั ะบ ะดะฐะฝะฝัะผ (ะธะฝะดะตะบั ะฟะพะบััะฒะฐะตั `Status`, ะฐ `OrderID` โ ะฒ ะบะปะฐััะตัะธะทะพะฒะฐะฝะฝะพะผ ัะบะฐะทะฐัะตะปะต).**  
> **ะขะตะฟะตัั ัะพะทะดะฐะดะธะผ ัะฐะฑะปะธัั, ะณะดะต Key Lookup ะฝะตะธะทะฑะตะถะตะฝ.**

> ะะปะธัะฝะธะต ััะฐัะธััะธะบะธ ะธ ะธะฝะดะตะบัะพะฒ ะฝะฐ ะฟะปะฐะฝ ะทะฐะฟัะพัะฐ
ะั ะฑัะดะตะผ ะธัะฟะพะปัะทะพะฒะฐัั ะพะดะธะฝ ะธ ัะพั ะถะต ะฑะฐะทะพะฒัะน ัะบัะธะฟั ัะพะทะดะฐะฝะธั ะะ ะธ ะพะดะธะฝ ะธ ัะพั ะถะต ัะตะปะตะฒะพะน ะทะฐะฟัะพั SELECT ะฒะพ ะฒัะตั ะทะฐะดะฐะฝะธัั, ะผะตะฝัั ัะพะปัะบะพ ะฝะฐัััะพะนะบะธ ะะ ะธะปะธ ะธะฝะดะตะบัั ะผะตะถะดั ัะฐะณะฐะผะธ

#### ะจะฐะณ 1. ะกะพะทะดะฐะนัะต ะฝะพะฒัั ะะ (ะฒัะฟะพะปะฝะธัะต ัะตะปะธะบะพะผ)
```sql
DROP DATABASE IF EXISTS StatsLab_Final;
CREATE DATABASE StatsLab_Final;
GO
USE StatsLab_Final;
GO

CREATE TABLE Orders (
    OrderID int IDENTITY(1,1),
    CustomerID int,
    Amount decimal(10,2),
    Status char(10),
    Description VARCHAR(8000) -- ะจะธัะพะบะธะน ััะพะปะฑะตั
);
GO

-- 10 000 ยซััะฐัััยป ะทะฐะบะฐะทะพะฒ
INSERT INTO Orders (CustomerID, Amount, Status, Description)
SELECT TOP 10000 
    1, 100.00, 'active', REPLICATE('Old order ', 100)
FROM sys.all_objects a, sys.all_objects b;
GO

-- ะัะบะปััะฐะตะผ ะฐะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ััะฐัะธััะธะบะธ ะะ ัะพะทะดะฐะฝะธั ะธะฝะดะตะบัะฐ, ััะพะฑั "ะทะฐะผะพัะพะทะธัั" ะตะต
ALTER DATABASE StatsLab_Final SET AUTO_UPDATE_STATISTICS OFF;
GO

-- ะกะพะทะดะฐะตะผ ะฝะตะฟะพะบััะฒะฐััะธะน ะธะฝะดะตะบั ะฝะฐ Status
CREATE NONCLUSTERED INDEX IX_Orders_Status ON Orders(Status);
GO

-- 5 000 ยซะฝะพะฒััยป ะทะฐะบะฐะทะพะฒ (ะดะฐะฝะฝัะต, ะบะพัะพััั ะฝะตั ะฒ ััะฐัะธััะธะบะต)
INSERT INTO Orders (CustomerID, Amount, Status, Description)
SELECT TOP 5000 
    2, 200.00, 'new', REPLICATE('New order ', 100)
FROM sys.all_objects a, sys.all_objects b;
GO
```

---

## ๐ ะะฐะดะฐะฝะธะต 4. 

#### ๐น ะะพ ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัะธััะธะบะธ (ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะฒัะธััะธะบะธ ะธ Key Lookup)

> ๐ก ะั ะธัะฟะพะปัะทัะตะผ ัััะฐัะตะฒััั ััะฐัะธััะธะบั ะฟะพ ัะผะพะปัะฐะฝะธั.
> *ะะตะนััะฒะธะต:* ะัะพััะพ ะฒัะฟะพะปะฝะธัั ะฆะตะปะตะฒะพะน ะทะฐะฟัะพั ััะฐะทั ะฟะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั ะะฐะทะพะฒะพะณะพ ัะบัะธะฟัะฐ.

#### ะจะฐะณ 1. ะัะฟะพะปะฝะธัะต ะฆะตะปะตะฒะพะน ะทะฐะฟัะพั

```sql
USE StatsLab_Final;
GO 
SET STATISTICS IO ON;
SET STATISTICS TIME ON;

SELECT OrderID, Amount, Description 
FROM Orders 
WHERE Status = 'new';
```

ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:

- **ะะฐััะตัะฝะพะต ัะธัะปะพ ัััะพะบ**: ~122.474 (ัะฒัะธััะธะบะฐ)
- **ะขะธะฟ ะพะฟะตัะฐัะพัะฐ**: ะะปะพะถะตะฝะฝัะต ัะธะบะปั + ะฃัะพัะฝัััะธะน ะทะฐะฟัะพั RID (Key Lookup)

---

## ๐ ะะฐะดะฐะฝะธะต 5. 

#### ๐น ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัะธััะธะบะธ (ะขะพัะฝะฐั ะพัะตะฝะบะฐ ะธ Key Lookup)

> ๐ก ะั ะฐะบััะฐะปะธะทะธััะตะผ ััะฐัะธััะธะบั, ะฝะพ ะฝะต ะผะตะฝัะตะผ ััััะบัััั ะธะฝะดะตะบัะฐ.
> *ะะตะนััะฒะธะต:* ะัะฟะพะปะฝะธัั ะบะพะผะฐะฝะดั ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัะธััะธะบะธ, ะฐ ะทะฐัะตะผ ัะฝะพะฒะฐ ะฒัะฟะพะปะฝะธัั ะฆะตะปะตะฒะพะน ะทะฐะฟัะพั.

#### ะจะฐะณ 1. ะะฑะฝะพะฒะธัะต ััะฐัะธััะธะบั

```sql
USE StatsLab_Final;
GO
UPDATE STATISTICS Orders IX_Orders_Status WITH FULLSCAN;
GO
```

#### ะจะฐะณ 2. ะัะฟะพะปะฝะธัะต ะทะฐะฟัะพั

```sql
USE StatsLab_Final;
GO 
SET STATISTICS IO ON;
SET STATISTICS TIME ON;

SELECT OrderID, Amount, Description 
FROM Orders 
WHERE Status = 'new';
```

#### ะจะฐะณ 3. ะ ะพััััะต:  

ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:
- **ะะฐััะตัะฝะพะต ัะธัะปะพ ัััะพะบ**: 5000 (ัะพัะฝะพ)
- **ะขะธะฟ ะพะฟะตัะฐัะพัะฐ**: ะะปะพะถะตะฝะฝัะต ัะธะบะปั + ะฃัะพัะฝัััะธะน ะทะฐะฟัะพั RID (Key Lookup ะพััะฐะตััั)
---

## ๐ ะะฐะดะฐะฝะธะต 6. 

#### ๐น ะัะธะฝัะดะธัะตะปัะฝัะน Table Scan (ะะณะฝะพัะธััะตะผ ะธะฝะดะตะบั)

> ๐ก  ะั ะทะฐััะฐะฒะปัะตะผ SQL Server ัะบะฐะฝะธัะพะฒะฐัั ะฒัั ัะฐะฑะปะธัั, ะธะณะฝะพัะธััั ะธะฝะดะตะบั.
> *ะะตะนััะฒะธะต:* ะัะฟะพะปะฝะธัั ะฆะตะปะตะฒะพะน ะทะฐะฟัะพั, ะดะพะฑะฐะฒะธะฒ ัะธะฝั WITH(INDEX(0)).

#### ะจะฐะณ 1. ะัะฟะพะปะฝะธัะต ะทะฐะฟัะพั ะผ
```sql
USE StatsLab_Final;
GO

SELECT OrderID, Amount, Description 
FROM Orders WITH(INDEX(0)) -- ะัะธะฝัะดะธัะตะปัะฝะพะต ัะบะฐะฝะธัะพะฒะฐะฝะธะต ะบััะธ
WHERE Status = 'new';

```

#### ะจะฐะณ 2. ะ ะพััััะต:  

ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:

- **ะขะธะฟ ะพะฟะตัะฐัะพัะฐ**: ะัะพัะผะพัั ัััะพะบ ัะฐะฑะปะธัั (Table Scan)
- **ะะพะณะธัะตัะบะธะต ััะตะฝะธั**: ะะพะปะถะฝั ะฑััั ะฒััะต, ัะตะผ ะฒ ะะฐะดะฐะฝะธะธ 1/2 ะธะท-ะทะฐ ััะตะฝะธั ัะธัะพะบะธั ัััะพะบ.

---

## ๐ ะะฐะดะฐะฝะธะต 7. 

#### ๐น ะกะพะทะดะฐะฝะธะต ะฟะพะบััะฒะฐััะตะณะพ ะธะฝะดะตะบัะฐ (ะะฟัะธะผะฐะปัะฝัะน ะฟะปะฐะฝ)

> ๐ก ะั ัะพะทะดะฐะตะผ ะธะดะตะฐะปัะฝัะน (ะฟะพะบััะฒะฐััะธะน) ะธะฝะดะตะบั, ะบะพัะพััะน ะธัะบะปััะฐะตั ะฝะตะพะฑัะพะดะธะผะพััั Key Lookup.
> *ะะตะนััะฒะธะต:* ะฃะดะฐะปะธัั ััะฐััะน ะธะฝะดะตะบั, ัะพะทะดะฐัั ะฝะพะฒัะน ะฟะพะบััะฒะฐััะธะน ะธะฝะดะตะบั, ะฒัะฟะพะปะฝะธัั ะฆะตะปะตะฒะพะน ะทะฐะฟัะพั.

#### ะจะฐะณ 1. ะฃะดะฐะปะธัั ััะฐััะน ะธะฝะดะตะบั ะธ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะน

```sql
USE StatsLab_Final;
GO

-- ะฃะดะฐะปัะตะผ ััะฐััะน ะธะฝะดะตะบั
DROP INDEX IX_Orders_Status ON Orders;
GO

-- ะกะพะทะดะฐะตะผ ะฟะพะบััะฒะฐััะธะน ะธะฝะดะตะบั
CREATE NONCLUSTERED INDEX IX_Cover 
ON Orders(Status) 
INCLUDE (OrderID, Amount, Description);
GO

```

#### ะจะฐะณ 2. ะัะฟะพะปะฝะธัะต ะทะฐะฟัะพั

```sql
USE StatsLab_Final;
GO 
SET STATISTICS IO ON;
SET STATISTICS TIME ON;

SELECT OrderID, Amount, Description 
FROM Orders 
WHERE Status = 'new';
```

#### ะจะฐะณ 3. ะ ะพััััะต:  

ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:
- **ะขะธะฟ ะพะฟะตัะฐัะพัะฐ**: ะะพะธัะบ ะฒ ะธะฝะดะตะบัะต [NonClustered] (Index Seek), ะฑะตะท Key Lookup.
- **ะะพะณะธัะตัะบะธะต ััะตะฝะธั**: ะะพะปะถะฝั ะฑััั ะผะธะฝะธะผะฐะปัะฝัะผะธ.

ะะฐะฟะพะปะฝะธัะต ััะฐะฒะฝะธัะตะปัะฝัั ัะฐะฑะปะธัั

ะกัะฐะฒะฝะธัะตะปัะฝะฐั ัะฐะฑะปะธัะฐ ัะตะทัะปััะฐัะพะฒ
| ะะพะบะฐะทะฐัะตะปั |	ะะฐะดะฐะฝะธะต 4 (ะกัะฐัะฐั ััะฐั., Key Lookup) |	ะะฐะดะฐะฝะธะต 5 (ะะพะฒะฐั ััะฐั., Key Lookup)	|ะะฐะดะฐะฝะธะต 6 (ะัะธะฝัะด. Table Scan)	|ะะฐะดะฐะฝะธะต 7 (ะะพะบััะฒะฐััะธะน ะธะฝะดะตะบั)|
|----------|-----------------------------|---------------------|----------------|--------------|
|ะะฐััััะฝะพะต ัะธัะปะพ ัััะพะบ|	~122.474	|5000	|5000|	5000|
|ะคะฐะบัะธัะตัะบะพะต ัะธัะปะพ ัััะพะบ|	5000	|5000	|5000|	5000|
|ะะพะณะธัะตัะบะธะต ะพะฟะตัะฐัะธะธ ััะตะฝะธั|	...	|...|	...|	...|
|ะะฐััะฐัะตะฝะฝะพะต ะฒัะตะผั (ะผั)	|...	|...	|...	|...|
|ะขะธะฟ ะพะฟะตัะฐัะพัะฐ|	ะะปะพะถะตะฝะฝัะต ัะธะบะปั + RID Lookup|	ะะปะพะถะตะฝะฝัะต ัะธะบะปั + RID Lookup|	ะัะพัะผะพัั ัััะพะบ ัะฐะฑะปะธัั|	ะะพะธัะบ ะฒ ะธะฝะดะตะบัะต [NonClustered]|
---


## ๐ ะะฐะดะฐะฝะธะต 8. ะัะฒะตัั ะฝะฐ ะฒะพะฟัะพัั

1. ะะพัะตะผั ะฒ ะะฐะดะฐะฝะธะธ 4 (ะดะพ ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัะธััะธะบะธ) ัะฐััะตัะฝะพะต ัะธัะปะพ ัััะพะบ ัะพััะฐะฒะปัะปะพ ะฟัะธะฑะปะธะทะธัะตะปัะฝะพ 122.474, ัะพัั ัะฐะบัะธัะตัะบะพะต ัะธัะปะพ ะฑัะปะพ ัะพะฒะฝะพ 5000?
ะะฑัััะฝะธัะต ัะพะปั ะณะธััะพะณัะฐะผะผั ะธ ะฒะตะบัะพัะฐ ะฟะปะพัะฝะพััะธ ะฒ ะผะตัะฐะฝะธะทะผะต ะพัะตะฝะบะธ ะบะฐัะดะธะฝะฐะปัะฝะพััะธ (Cardinality Estimation) SQL Server.

2. ะกัะฐะฒะฝะธัะต ะฟะปะฐะฝั ะฒัะฟะพะปะฝะตะฝะธั ะฒ ะะฐะดะฐะฝะธัั 4 ะธ 5.
ะะพัะตะผั, ะฝะตัะผะพััั ะฝะฐ ัะพัะฝัั ะพัะตะฝะบั ะบะพะปะธัะตััะฒะฐ ัััะพะบ ะฒ ะะฐะดะฐะฝะธะธ 2 (5000), ะพะฟัะธะผะธะทะฐัะพั ะฒัะต ัะฐะฒะฝะพ ะฒัะฑัะฐะป ะพะฟะตัะฐัะพั Key Lookup (ะฃัะพัะฝัััะธะน ะทะฐะฟัะพั RID / ะะปะพะถะตะฝะฝัะต ัะธะบะปั)? ะงัะพ ัะฒะปัะตััั "ัะทะบะธะผ ะผะตััะพะผ" ััะพะณะพ ะฟะปะฐะฝะฐ?
3. ะกัะฐะฒะฝะธัะต ะบะพะปะธัะตััะฒะพ ะปะพะณะธัะตัะบะธั ะพะฟะตัะฐัะธะน ััะตะฝะธั (Logical Reads) ะฒ ะะฐะดะฐะฝะธะธ 5 ะธ ะะฐะดะฐะฝะธะธ 6.

ะ ะบะฐะบะพะผ ะธะท ััะธั ะทะฐะดะฐะฝะธะน ะฑัะปะพ ะฒัะฟะพะปะฝะตะฝะพ ะฑะพะปััะต ััะตะฝะธะน? ะะพัะตะผั ะฟะพะปะฝัะน ะฟัะพัะผะพัั ัะฐะฑะปะธัั (Table Scan) ะฒ ะะฐะดะฐะฝะธะธ 6 ะพะบะฐะทะฐะปัั ะดะพัะพะถะต/ะดะตัะตะฒะปะต, ัะตะผ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะธะฝะดะตะบัะฐ ั ะฟะพัะปะตะดัััะธะผ Key Lookup ะฒ ะะฐะดะฐะฝะธะธ 5?

4. ะะฐะบะพะต ะทะฐะดะฐะฝะธะต ะฟะพะบะฐะทะฐะปะพ ะฝะฐะธะปัััะธะน (ะพะฟัะธะผะฐะปัะฝัะน) ะฟะปะฐะฝ ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะฟัะพัะฐ ะธ ะฟะพัะตะผั.

5. ะะฑัััะฝะธัะต ะฟัะธะฝัะธะฟ ัะฐะฑะพัั ะฟะพะบััะฒะฐััะตะณะพ ะธะฝะดะตะบัะฐ (ะะฐะดะฐะฝะธะต 7) ะธ ะฟะพัะตะผั ะตะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะธะฒะตะปะพ ะบ ะผะธะฝะธะผะฐะปัะฝะพะผั ะบะพะปะธัะตััะฒั ะปะพะณะธัะตัะบะธั ะพะฟะตัะฐัะธะน ััะตะฝะธั ะธ ะพััััััะฒะธั ะพะฟะตัะฐัะพัะฐ Key Lookup.
ะัะตะดะปะพะถะธัะต, ะบะฐะบะธะต ะดะตะนััะฒะธั ะฐะดะผะธะฝะธัััะฐัะพั ะฑะฐะทั ะดะฐะฝะฝัั ะดะพะปะถะตะฝ ะฟัะตะดะฟัะธะฝััั ะฒ ัะตะฐะปัะฝัั ััะปะพะฒะธัั, ะตัะปะธ ะพะฝ ะฒะธะดะธั, ััะพ ะฟะปะฐะฝ ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะฟัะพัะฐ ะธัะฟะพะปัะทัะตั Key Lookup ะธ ะฟะพะบะฐะทัะฒะฐะตั ะฝะตะฒะตัะฝัั ะพัะตะฝะบั ะบะฐัะดะธะฝะฐะปัะฝะพััะธ?
ะะฐะทะพะฒะธัะต ะดะฒะฐ ะพัะฝะพะฒะฝัั ะดะตะนััะฒะธั ะฟะพ ะพะฟัะธะผะธะทะฐัะธะธ.

---

## ๐ **ะขัะตะฑะพะฒะฐะฝะธั ะบ ะพััััั (Word-ะดะพะบัะผะตะฝั)**

# ะคะฐะนะป ะดะพะปะถะตะฝ ะฝะฐะทัะฒะฐัััั: **`ะัััั_ะคะฐะผะธะปะธั_ะััะฟะฟะฐ.docx`**  (ะฝะฐะฟัะธะผะตั, `ะัััั_Petrov_IS-23.docx`)

**ะกัััะบัััะฐ ะพััััะฐ:**

1. **ะขะธััะปัะฝัะน ะปะธัั** (ะคะะ, ะณััะฟะฟะฐ, ะดะฐัะฐ, ะฝะฐะทะฒะฐะฝะธะต ัะฐะฑะพัั).  
2. **ะฆะตะปั ัะฐะฑะพัั**.  
3. **ะฅะพะด ะฒัะฟะพะปะฝะตะฝะธั**:  
   - ะะพะปะฝัะน ัะตะบัั **ััะฐััะพะฒะพะณะพ ัะบัะธะฟัะฐ** (ั ะฒะฐัะตะน ัะฐะผะธะปะธะตะน ะฒ ะบะพะผะผะตะฝัะฐัะธะธ).  
   - **ะกะบัะธะฝัะพัั** ะธะท SSMS ัะพ **ะฒัะตะผะธ ะฒัะฟะพะปะฝะตะฝะฝัะผะธ SQL-ะบะพะผะฐะฝะดะฐะผะธ** ะธะท ะทะฐะดะฐะฝะธะน 1โ7.  
     - ะะฐ ัะบัะธะฝัะพัะต ะดะพะปะถะฝั ะฑััั ะฒะธะดะฝั:  
       - ะขะตะบัั ะบะพะผะฐะฝะดั(ั),  
       - ะกะพะพะฑัะตะฝะธะต ะพะฑ ััะฟะตัะฝะพะผ ะฒัะฟะพะปะฝะตะฝะธะธ (ยซะะพะผะฐะฝะดั ะฒัะฟะพะปะฝะตะฝั ััะฟะตัะฝะพยป),  
       - ะะผั ะฑะฐะทั ะดะฐะฝะฝัั ะฒ ะทะฐะณะพะปะพะฒะบะต ะพะบะฝะฐ ะธะปะธ ะฒ ัััะพะบะต ัะพััะพัะฝะธั.  
   - ะะพะด ะบะฐะถะดัะผ ัะบัะธะฝัะพัะพะผ โ **ะฟะพะดะฟะธัั ั ะฟะพััะฝะตะฝะธะตะผ**, ะฝะฐะฟัะธะผะตั:  
     > *ะะธั. 1. ะะตะทัะปััะฐั ะฟัะพะฒะตัะบะธ HEAP ะธ AUTO_UPDATE OFF.*  
     > *ะะธั. 2. ะะปะฐะฝ ะฒัะฟะพะปะฝะตะฝะธั ะดะพ ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัะธััะธะบะธ: ะัะตะฝะบะฐ = 122, ะคะฐะบั = 5000.*  
     > *ะะธั. 3. ะะบะฝะพ ยซะกะพะพะฑัะตะฝะธัยป ั ะปะพะณะธัะตัะบะธะต ะพะฟะตัะฐัะธะธ ััะตะฝะธั = 14 850.*  
     > *ะะธั. 4. ะะปะฐะฝ ะฟะพัะปะต ะฟะพะบััะฒะฐััะตะณะพ ะธะฝะดะตะบัะฐ: ัะพะปัะบะพ ยซะะพะธัะบ ะฒ ะธะฝะดะตะบัะตยป.*  
   - **ะะฑัะทะฐัะตะปัะฝะพ ะฒะบะปััะธัะต ัะฐะฑะปะธัั ััะฐะฒะฝะตะฝะธั ัััะตะบัะธะฒะฝะพััะธ**:
    
   - ะัะฒะตัั ะฝะฐ ะฒะพะฟัะพัั ะธะท ะทะฐะดะฐะฝะธั 8.  
4. **ะัะฒะพะด**:  
   - ะงัะพ ะฝะพะฒะพะณะพ ะฒั ัะทะฝะฐะปะธ ะพ ััะฐัะธััะธะบะต ะธ ะฒัะฑะพัะต ะฟะปะฐะฝะฐ?  
   - ะก ะบะฐะบะธะผะธ ัััะดะฝะพัััะผะธ ััะพะปะบะฝัะปะธัั ะฟัะธ ัะฐะฑะพัะต ั `DBCC SHOW_STATISTICS` ะธ ะฟะปะฐะฝะพะผ ะฒัะฟะพะปะฝะตะฝะธั?  
   - ะะพัะตะผั ะฒะฐะถะฝะพ ะพะฑะฝะพะฒะปััั ััะฐัะธััะธะบั ะฟะพัะปะต ะผะฐััะพะฒัั ะธะทะผะตะฝะตะฝะธะน?

> โ **ะะฐะถะฝะพ**:  
> - ะัััั **ะฑะตะท ัะบัะธะฝัะพัะพะฒ** (ะธะปะธ ะฑะตะท ะฐะปััะตัะฝะฐัะธะฒะฝะพะณะพ ะบะพะดะฐ ั ะบะพะผะผะตะฝัะฐัะธัะผะธ) ะฝะต ะฟัะธะฝะธะผะฐะตััั.  
> - **ะะตะท ัะฐะฑะปะธัั ััะฐะฒะฝะตะฝะธั ะธ ะฟะพััะฝะตะฝะธั ะัะตะฝะบะฐ/ะคะฐะบั** โ ะผะฐะบัะธะผะฐะปัะฝะฐั ะพัะตะฝะบะฐ **ะฝะต ะฒััะต ยซ4ยป**.  
> - ะกะบัะธะฝัะพัั ะดะพะปะถะฝั ะฑััั **ัััะบะธะผะธ ะธ ัะธัะฐะตะผัะผะธ**.  
> - ะะต ะฒััะฐะฒะปัะนัะต ะพะดะธะฝ ะพะฑัะธะน ัะบัะธะฝัะพั ะฒัะตะณะพ ะพะบะฝะฐ SSMS.

---

## ๐ค ะกะดะฐัะฐ ัะฐะฑะพัั

1. ะัะพัะผะธัะต ะพัััั ะฒ Microsoft Word.  
2. ะกะพััะฐะฝะธัะต ัะฐะนะป ะฒ ัะพัะผะฐัะต `.docx`.  
3. ะะตัะตะนะดะธัะต ะฟะพ ัััะปะบะต ะฝะฐ [**Google-ัะพัะผั**](https://forms.gle/ZyRB7xgMEPcXqGim7).  
4. ะฃะบะฐะถะธัะต ะคะะ ะธ ะณััะฟะฟั.  
5. ะะฐะณััะทะธัะต ัะฐะนะป ะพััััะฐ.  
6. **ะกัะพะบ ัะดะฐัะธ**: ะดะพ 23:59 **11 ะดะตะบะฐะฑัั 2025 ะณ.**

---

## ๐ ะัะธัะตัะธะธ ะพัะตะฝะธะฒะฐะฝะธั

| ะัะธัะตัะธะน | ะัะตะฝะบะฐ ยซ5ยป | ะัะตะฝะบะฐ ยซ4ยป | ะัะตะฝะบะฐ ยซ3ยป |
|--------|-------------|-------------|-------------|
| **ะะฐะดะฐะฝะธั 1โ3** | ะัะฟะพะปะฝะตะฝั ะฟะพะปะฝะพัััั, ั ะฟะพััะฝะตะฝะธัะผะธ | ะัะฟะพะปะฝะตะฝั, ะฝะพ ะฑะตะท ะฐะฝะฐะปะธะทะฐ | ะขะพะปัะบะพ ัะบะพะฟะธัะพะฒะฐะฝั |
| **ะะฐะดะฐะฝะธั 4โ5** | ะะฝะฐะปะธะท ะณะธััะพะณัะฐะผะผั ะธ ะฟะพััะดะบะฐ ััะพะปะฑัะพะฒ โ ะฟะพะปะฝัะน | ะััั ัะฐััััั, ะฝะพ ะฑะตะท ะฒัะฒะพะดะพะฒ | ะะต ะฒัะฟะพะปะฝะตะฝั |
| **ะะฐะดะฐะฝะธะต 6-7** | ะกะบัะธะฟั ัะฐะฑะพัะฐะตั, ะบะตะนั ะพะฑัััะฝัะฝ | ะกะบัะธะฟั ะตััั, ะบะตะนั ัะฐััะธัะฝะพ | ะะต ะฒัะฟะพะปะฝะตะฝะพ |
| **ะัะฒะตัั ะฝะฐ ะฒะพะฟัะพัั** | ะัะต ะพัะฒะตัั ะฟะพะปะฝัะต, ั ัะตัะผะธะฝะฐะผะธ | 3โ4 ะพัะฒะตัะฐ | โค2 ะพัะฒะตัะฐ |
| **ะัะพัะผะปะตะฝะธะต** | ะกัััะบัััะฐ ัะพะฑะปัะดะตะฝะฐ, ัะบัะธะฝัะพัั ะตััั | ะะตะปะบะธะต ะฝะฐัััะตะฝะธั | ะะตะท ัะบัะธะฝัะพัะพะฒ |

> ๐ก **ะะฐะบัะธะผะฐะปัะฝัะน ะฑะฐะปะป**: 5  
> โ **ะะตะท ัะฐะฑะปะธัั ััะฐะฒะฝะตะฝะธั ะธ ะะฐะดะฐะฝะธะน 4โ6** โ ะฝะต ะฒััะต ยซ4ยป.

---

### ๐ ๐ ๐ ะะฐะฒะธะณะฐัะธั ะฟะพ ะบัััั

| [ะัะตะดัะดััะตะต ะทะฐะฝััะธะต](../LESSONS/LESSON8.MD) | &nbsp; | [ะกะปะตะดัััะตะต ะทะฐะฝััะธะต](../LESSONS/LESSON8.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| ๐ [ะะตะบัะธั โ7](../LESSONS/LESSON8.MD) | ๐ [ะกะพะดะตัะถะฐะฝะธะต](../README.MD) | ๐ป [ะะตะบัะธั โ9](../LESSONS/LESSON9.MD) |

---

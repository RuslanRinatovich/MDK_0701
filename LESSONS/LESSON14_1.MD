### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR12.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR13.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ12](../LESSONS/PR12.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ13](../LESSONS/PR13.MD) |

---

# üéì **–õ–µ–∫—Ü–∏—è 13.1. –û—Å–Ω–æ–≤—ã —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã**  
‚è±Ô∏è **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 90 –º–∏–Ω—É—Ç

---

### **üìñ –ß–∞—Å—Ç—å 1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã?**

**üîπ –ü—Ä–æ—Å—Ç–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**  
–•—Ä–∞–Ω–∏–º–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ ‚Äî —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥ SQL, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –ø–æ –∏–º–µ–Ω–∏.

**üîπ –ó–∞—á–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –ø—Ä–æ—Ü–µ–¥—É—Ä—ã?**

| –°–∏—Ç—É–∞—Ü–∏—è | –ë–µ–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã | –° –ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π |
|----------|---------------|--------------|
| –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–∏—à–µ–º 10 –∑–∞–ø—Ä–æ—Å–æ–≤ | `EXEC usp_DailyCheck` |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã | –ò—â–µ–º –Ω—É–∂–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ –∑–∞–º–µ—Ç–∫–∞—Ö | `EXEC usp_Diagnose` |
| –û—Ç—á—ë—Ç –¥–ª—è –Ω–∞—á–∞–ª—å—Å—Ç–≤–∞ | –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é | `EXEC usp_WeeklyReport` |

**üîπ –ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**
```sql
-- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑:
SELECT name FROM sys.databases;
SELECT COUNT(*) FROM sys.tables;
EXEC sp_spaceused;

-- –î–µ–ª–∞–µ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—É –æ–¥–∏–Ω —Ä–∞–∑:
CREATE PROCEDURE usp_QuickCheck AS ...

-- –ò –∑–∞–ø—É—Å–∫–∞–µ–º –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
EXEC usp_QuickCheck;
```

---

### **üìñ –ß–∞—Å—Ç—å 2. –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å–æ–∑–¥–∞–Ω–∏—è**

**üîπ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
```sql
-- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Ä–∞–∑–±–µ—Ä—ë–º –ø–æ –ø–æ—Ä—è–¥–∫—É:
CREATE PROCEDURE –∏–º—è_–ø—Ä–æ—Ü–µ–¥—É—Ä—ã  -- 1. –°–æ–∑–¥–∞—ë–º
AS                              -- 2. –ù–∞—á–∞–ª–æ –æ–ø–∏—Å–∞–Ω–∏—è
BEGIN                           -- 3. –ù–∞—á–∞–ª–æ –±–ª–æ–∫–∞ –∫–æ–º–∞–Ω–¥
    -- –ó–¥–µ—Å—å –∫–æ–º–∞–Ω–¥—ã SQL
    SELECT ...;
    PRINT ...;
END                            -- 4. –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –∫–æ–º–∞–Ω–¥
GO                             -- 5. –ö–æ–Ω–µ—Ü —Å–æ–∑–¥–∞–Ω–∏—è
```

**üîπ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä:**
```sql
-- –ù–∞—à–∞ –ø–µ—Ä–≤–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
CREATE PROCEDURE usp_HelloWorld
AS
BEGIN
    PRINT '–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!';
    PRINT '–°–µ–≥–æ–¥–Ω—è: ' + CONVERT(VARCHAR, GETDATE(), 104);
    SELECT '–≠—Ç–æ –º–æ—è –ø–µ—Ä–≤–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞' AS Message;
END
GO

-- –ó–∞–ø—É—Å–∫–∞–µ–º
EXEC usp_HelloWorld;
```

---

### **üìñ –ß–∞—Å—Ç—å 3. –ö–æ–º–∞–Ω–¥–∞ PRINT**

**üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ PRINT?**  
–≠—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∞–Ω–∞–ª–æ–≥ `Console.WriteLine` –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏).

**üîπ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```sql
-- –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã
PRINT '–û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ';
PRINT '–°–µ–≥–æ–¥–Ω—è: ' + CONVERT(VARCHAR, GETDATE(), 120);

-- –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
DECLARE @Count INT = 10;
PRINT '–ù–∞–π–¥–µ–Ω–æ: ' + CAST(@Count AS VARCHAR) + ' –∑–∞–ø–∏—Å–µ–π';

-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
PRINT '==============================';
PRINT '     –û–¢–ß–Å–¢ –ü–û –°–ï–†–í–ï–†–£';
PRINT '==============================';
```

**üîπ –ì–¥–µ –≤–∏–¥–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç PRINT?**
- –í **SSMS**: –≤–∫–ª–∞–¥–∫–∞ "–°–æ–æ–±—â–µ–Ω–∏—è" (Messages)
- –í **–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö**: –≤ –ø–æ—Ç–æ–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π SQL Server
- –í **–ª–æ–≥–∞—Ö**: –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø–∏—Å—å

---

### **üìñ –ß–∞—Å—Ç—å 4. –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è**

**üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
1. **–ú–∞–∫—Å–∏–º—É–º 128 —Å–∏–º–≤–æ–ª–æ–≤**
2. **–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _, @, #, $
3. **–ù–µ–ª—å–∑—è –Ω–∞—á–∏–Ω–∞—Ç—å** —Å —Ü–∏—Ñ—Ä—ã
4. **–õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∞—Ç–∏–Ω–∏—Ü—É**

**üîπ –ü—Ä–µ—Ñ–∏–∫—Å—ã (—á—Ç–æ —Å—Ç–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–µ):**

| –ü—Ä–µ—Ñ–∏–∫—Å | –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|---------|--------------|--------|------------------|
| **usp_** | User Stored Procedure | `usp_CheckServer` | –í—Å–µ —Å–≤–æ–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã |
| **sp_** | System Procedure | `sp_helpdb` | –¢–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ |
| **adm_** | Administrative | `adm_BackupAll` | –ê–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä—ã |
| **rpt_** | Report | `rpt_DailySales` | –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –æ—Ç—á—ë—Ç–æ–≤ |

**üîπ –ü–æ—á–µ–º—É usp_, –∞ –Ω–µ sp_?**
1. **–ë—ã—Å—Ç—Ä–µ–µ** ‚Äî SQL Server –Ω–µ –∏—â–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∞–∑–∞—Ö
2. **–ü–æ–Ω—è—Ç–Ω–µ–µ** ‚Äî —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, —á—Ç–æ —ç—Ç–æ –≤–∞—à–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–µ–µ** ‚Äî `sp_` –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è Microsoft

---

### **üìñ –ß–∞—Å—Ç—å 5. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–µ–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä**

**üîπ –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```sql
CREATE PROCEDURE usp_ServerInfo
AS
BEGIN
    PRINT '=== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–ï–†–í–ï–†–ï ===';
    PRINT '';
    
    -- 1. –í–µ—Ä—Å–∏—è SQL Server
    PRINT '1. –í–µ—Ä—Å–∏—è SQL Server:';
    SELECT @@VERSION AS Version;
    
    PRINT '';
    
    -- 2. –¢–µ–∫—É—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    PRINT '2. –¢–µ–∫—É—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:';
    SELECT DB_NAME() AS CurrentDB;
    
    PRINT '';
    
    -- 3. –í—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    PRINT '3. –í—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:';
    SELECT name, state_desc 
    FROM sys.databases 
    ORDER BY name;
    
    PRINT '';
    PRINT '=== –ö–û–ù–ï–¶ –û–¢–ß–Å–¢–ê ===';
END
GO
```

**üîπ –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:**
```sql
CREATE PROCEDURE usp_WhoIsConnected
AS
BEGIN
    PRINT '–ö—Ç–æ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É:';
    PRINT '-----------------------';
    
    SELECT 
        session_id AS 'ID',
        login_name AS '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        host_name AS '–ö–æ–º–ø—å—é—Ç–µ—Ä',
        program_name AS '–ü—Ä–æ–≥—Ä–∞–º–º–∞'
    FROM sys.dm_exec_sessions
    WHERE is_user_process = 1
    ORDER BY session_id;
    
    PRINT '–í—Å–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: ' + CAST(@@ROWCOUNT AS VARCHAR);
END
GO
```

---

### **üìñ –ß–∞—Å—Ç—å 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏**

**üîπ –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É:**
```sql
-- –ò–∑–º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É
ALTER PROCEDURE usp_HelloWorld
AS
BEGIN
    PRINT '–ù–æ–≤–∞—è —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è!';
    PRINT '–í—Ä–µ–º—è: ' + CONVERT(VARCHAR, GETDATE(), 108);
END
GO
```

**üîπ –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É:**
```sql
-- –£–¥–∞–ª—è–µ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—É
DROP PROCEDURE usp_HelloWorld;

-- –° –ø—Ä–æ–≤–µ—Ä–∫–æ–π (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–∫–∏)
IF OBJECT_ID('usp_HelloWorld', 'P') IS NOT NULL
    DROP PROCEDURE usp_HelloWorld;
```

**üîπ –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
```sql
-- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–¥ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
EXEC sp_helptext 'usp_ServerInfo';

-- –ò–ª–∏ —Ç–∞–∫
SELECT OBJECT_DEFINITION(OBJECT_ID('usp_ServerInfo'));
```

---

### **üìñ –ß–∞—Å—Ç—å 7. –ì–¥–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã?**

**üîπ –î–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Å—Ç–∞:**

1. **–í –±–∞–∑–µ master** ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –≤—Å–µ—Ö –±–∞–∑
   ```sql
   USE master;
   CREATE PROCEDURE usp_GlobalCheck AS ...  -- –í–∏–¥–Ω–∞ –≤–µ–∑–¥–µ
   ```

2. **–í –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∞–∑–µ** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π –±–∞–∑—ã
   ```sql
   USE MyDatabase;
   CREATE PROCEDURE usp_LocalCheck AS ...  -- –¢–æ–ª—å–∫–æ –¥–ª—è MyDatabase
   ```

**üîπ –î–ª—è –∞–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä –∏—Å–ø–æ–ª—å–∑—É–µ–º master!**

---

### **üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –ª–µ–∫—Ü–∏–∏**

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É `usp_MyFirstCheck`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
1. –¢–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
2. –ò–º—è —Å–µ—Ä–≤–µ—Ä–∞
3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
4. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü –≤ —Ç–µ–∫—É—â–µ–π –±–∞–∑–µ

---

### **üìã –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**

**‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å:**
1. **CREATE PROCEDURE** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
2. **EXEC –∏–º—è_–ø—Ä–æ—Ü–µ–¥—É—Ä—ã** ‚Äî –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
3. **PRINT** ‚Äî –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π, **SELECT** ‚Äî –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
4. **usp_** ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Å–≤–æ–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
5. **BEGIN...END** ‚Äî –æ–±—Ä–∞–º–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
6. **GO** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

**‚ùå –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:**
1. –ó–∞–±—ã–≤–∞—é—Ç `GO` –ø–æ—Å–ª–µ `CREATE PROCEDURE`
2. –ò—Å–ø–æ–ª—å–∑—É—é—Ç `sp_` –¥–ª—è —Å–≤–æ–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
3. –ü—É—Ç–∞—é—Ç `PRINT` –∏ `SELECT`
4. –°–æ–∑–¥–∞—é—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É –Ω–µ –≤ —Ç–æ–π –±–∞–∑–µ

---

### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR12.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR13.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ12](../LESSONS/PR12.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ13](../LESSONS/PR13.MD) |


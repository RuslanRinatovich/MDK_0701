### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/LESSON8.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/LESSON9.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–õ–µ–∫—Ü–∏—è ‚Ññ7](../LESSONS/LESSON8.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–õ–µ–∫—Ü–∏—è ‚Ññ8](../LESSONS/LESSON9.MD) |

---
# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ7  
## –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è

> **–¶–µ–ª—å**: –ù–∞—É—á–∏—Ç—å—Å—è –∏–∑–º–µ—Ä—è—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é —á–µ—Ä–µ–∑ DMV, –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É `REORGANIZE` –∏ `REBUILD`, –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ `–ª–æ–≥–∏—á–µ—Å–∫–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º —á—Ç–µ–Ω–∏—è`.  
> **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2 –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏—Ö —á–∞—Å–∞  
> **–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ**: SSMS —Å —Ä—É—Å—Å–∫–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π, SQL Server Developer Edition

---

### ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–π SSMS!

1. **–°–ª–æ–≤–∞ `Table`, `Index`, `Order` ‚Äî –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏:  
   ```sql
   AS [Table], AS [Index]
   ```
2. **–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `–¥–¥.–º–º.–≥–≥–≥–≥`** ‚Üí —Å—Ç—Ä–æ–∫–∞ `'2024-01-01'` –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É.  
   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:  
   ```sql
   CAST('2024-01-01' AS date)
   -- –∏–ª–∏
   '2024-01-01T00:00:00'
   ```

---

## üì• –®–∞–≥ 0. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ)

```sql
-- –°–æ–∑–¥–∞—ë–º –ë–î —Å ¬´–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–µ–π¬ª
CREATE DATABASE FragmentLab;
GO
USE FragmentLab;
GO

CREATE TABLE Orders (
    OrderID int IDENTITY(1,1),
    CustomerID int,
    OrderDate datetime,
    Amount decimal(10,2)
);
GO

-- –ó–∞–ø–æ–ª–Ω—è–µ–º 50 000 —Å—Ç—Ä–æ–∫
WITH Nums AS (
    SELECT TOP 50000 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS n
    FROM sys.columns c1, sys.columns c2
)
INSERT INTO Orders (CustomerID, OrderDate, Amount)
SELECT 
    ABS(CHECKSUM(NEWID())) % 1000 + 1,
    DATEADD(day, -ABS(CHECKSUM(NEWID())) % 365, GETDATE()),
    CAST(RAND(CHECKSUM(NEWID())) * 1000 AS decimal(10,2))
FROM Nums;
GO

-- –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å—ã
CREATE CLUSTERED INDEX IX_Orders_Date ON Orders(OrderDate);
CREATE NONCLUSTERED INDEX IX_Orders_Customer ON Orders(CustomerID);
GO

-- ¬´–ü–æ—Ä—Ç–∏–º¬ª –∏–Ω–¥–µ–∫—Å: —É–¥–∞–ª—è–µ–º 20% –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –ù–û–í–´–ï —Å—Ç—Ä–æ–∫–∏ –°–û –°–¢–ê–†–´–ú–ò –î–ê–¢–ê–ú–ò (–≤ —Å–µ—Ä–µ–¥–∏–Ω—É!)
DELETE FROM Orders WHERE OrderID % 5 = 0;
GO

-- üîë –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –≤—Å—Ç–∞–≤–∫–∞ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é!
INSERT INTO Orders (CustomerID, OrderDate, Amount)
SELECT 
    ABS(CHECKSUM(NEWID())) % 1000 + 1,
    -- –î–∞—Ç—ã –æ—Ç 1 –¥–æ 2 –ª–µ—Ç –Ω–∞–∑–∞–¥ ‚Äî –ø–æ–ø–∞–¥–∞—é—Ç –í–ù–£–¢–†–¨ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
    DATEADD(day, -365 - ABS(CHECKSUM(NEWID())) % 365, GETDATE()),
    CAST(RAND(CHECKSUM(NEWID())) * 500 AS decimal(10,2))
FROM (SELECT TOP 20000 n 
      FROM (SELECT ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) n 
            FROM sys.columns c1, sys.columns c2) t) nums;
GO
```

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ **–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å** (—Å–∫–æ–±–∫–∏ + –¥–∞—Ç—ã):
   ```sql
   SELECT 
       OBJECT_NAME(ips.object_id) AS [Table],           -- ‚Üê [Table], –∞ –Ω–µ Table
       i.name AS [Index],                               -- ‚Üê [Index]
       ips.avg_fragmentation_in_percent AS ExtFrag,
       ips.avg_page_space_used_in_percent AS IntFrag,
       ips.page_count AS Pages
   FROM sys.dm_db_index_physical_stats(DB_ID(), NULL, NULL, NULL, 'SAMPLED') ips
   JOIN sys.indexes i ON ips.object_id = i.object_id AND ips.index_id = i.index_id
   WHERE ips.page_count > 100;
   ```

2. –í –æ—Ç—á—ë—Ç–µ —É–∫–∞–∂–∏—Ç–µ:  
   - `ExtFrag` –∏ `IntFrag` –¥–ª—è `IX_Orders_Date`,  
   - –ü–æ—á–µ–º—É `IntFrag` < 100%?

---

## üîç –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ª—è –∏–∑ –∑–∞–ø—Ä–æ—Å–∞? (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é!)

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å —Ç—Ä–µ–º—è –∫–ª—é—á–µ–≤—ã–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏. –í–æ—Ç —á—Ç–æ –æ–Ω–∏ **–Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–∑–Ω–∞—á–∞—é—Ç**:

### 1. `ExtFrag` ‚Üí **¬´–í–Ω–µ—à–Ω—è—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è, %¬ª**

> üí° **–ß—Ç–æ —ç—Ç–æ**: *¬´–ö–∞–∫ —Å–∏–ª—å–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–Ω–¥–µ–∫—Å–∞ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –¥–∏—Å–∫—É¬ª*.

#### üîπ –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∫–Ω–∏–≥—É, –≥–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–¥—É—Ç –Ω–µ –ø–æ–¥—Ä—è–¥:  
`—Å—Ç—Ä.1 ‚Üí —Å—Ç—Ä.42 ‚Üí —Å—Ç—Ä.3 ‚Üí —Å—Ç—Ä.27`  
‚Üí –ß—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≥–ª–∞–≤—É, –≤—ã –±–µ–≥–∞–µ—Ç–µ –ø–æ –∫–≤–∞—Ä—Ç–∏—Ä–µ ‚Üí **–º–µ–¥–ª–µ–Ω–Ω–æ**.

#### üîπ –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Ü–∏—Ñ—Ä—ã:
| –ó–Ω–∞—á–µ–Ω–∏–µ | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|---------|----------------|------------|
| **0‚Äì5%** | –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—á—Ç–∏ –ø–æ–¥—Ä—è–¥ | –û—Ç–ª–∏—á–Ω–æ, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º ‚úÖ |
| **5‚Äì30%** | –ï—Å—Ç—å ¬´–ø—Ä—ã–∂–∫–∏¬ª –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ | –¢–æ—Ä–º–æ–∑–∏—Ç `Scan`/`Range` ‚Üí `REORGANIZE` üßπ |
| **>30%** | –°—Ç—Ä–∞–Ω–∏—Ü—ã ¬´—Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã¬ª –ø–æ –≤—Å–µ–º—É –¥–∏—Å–∫—É | –°–µ—Ä—å—ë–∑–Ω–æ —Ç–æ—Ä–º–æ–∑–∏—Ç ‚Üí `REBUILD` üèóÔ∏è |

> üìå **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏**: –¥–æ–ª—è **–Ω–µ—Å–µ–∫–≤–µ–Ω—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫** –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏.

---

### 2. `IntFrag` ‚Üí **¬´–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü¬ª**

> üí° **–ß—Ç–æ —ç—Ç–æ**: *¬´–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–ª–æ—Ç–Ω–æ —É–ø–∞–∫–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã¬ª*.

#### üîπ –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∞–ª–æ–≥–∏—è:
–°—Ç—Ä–∞–Ω–∏—Ü–∞ = –ª–∏—Å—Ç –ê4 (8192 –±–∞–π—Ç–∞).  
–í—ã –Ω–∞–ø–∏—Å–∞–ª–∏ –Ω–∞ –Ω—ë–º 3 —Å—Ç—Ä–æ–∫–∏ ‚Üí –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ ‚Üí **—Ä–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å—Å—Ç–≤–æ**.

#### üîπ –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Ü–∏—Ñ—Ä—ã:
| –ó–Ω–∞—á–µ–Ω–∏–µ | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|---------|----------------|------------|
| **80‚Äì95%** | –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—á—Ç–∏ –ø–æ–ª–Ω—ã–µ | –ò–¥–µ–∞–ª—å–Ω–æ ‚úÖ |
| **70‚Äì80%** | –ù–µ–º–Ω–æ–≥–æ –ø—É—Å—Ç–æ–≥–æ –º–µ—Å—Ç–∞ | –ù–æ—Ä–º–∞–ª—å–Ω–æ (–±—É—Ñ–µ—Ä –ø–æ–¥ `UPDATE`) |
| **< 75%** | –°—Ç—Ä–∞–Ω–∏—Ü—ã ¬´–ø–æ–ª—É–ø—É—Å—Ç—ã–µ¬ª | –¢—Ä–∞—Ç–∏–º –ø–∞–º—è—Ç—å ‚Üí `REBUILD` —Å `FILLFACTOR` |

> üìå **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏**: —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–∑–∞–Ω—è—Ç—ã—Ö –±–∞–π—Ç / 8192** √ó 100%.  
> üí° **–ü–æ—á–µ–º—É < 100% ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ?**  
> ‚Äî `INSERT` –≤ —Å–µ—Ä–µ–¥–∏–Ω—É ‚Üí SQL Server –æ—Å—Ç–∞–≤–ª—è–µ—Ç ¬´–±—É—Ñ–µ—Ä¬ª –ø–æ–¥ –±—É–¥—É—â–∏–µ `UPDATE`,  
> ‚Äî –ù–æ < 75% ‚Üí –º–Ω–æ–≥–æ `DELETE` –∏–ª–∏ ¬´–Ω–µ–ø–ª–æ—Ç–Ω—ã–µ¬ª `INSERT`.

---

### 3. `Pages` ‚Üí **¬´–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –∏–Ω–¥–µ–∫—Å–µ¬ª**

> üí° **–ß—Ç–æ —ç—Ç–æ**: *¬´–°–∫–æ–ª—å–∫–æ –ª–∏—Å—Ç–æ–≤ –ê4 –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å –≤–µ—Å—å –∏–Ω–¥–µ–∫—Å¬ª*.

#### üîπ –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:
- **1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ = 8 –ö–ë**,  
- **100 —Å—Ç—Ä–∞–Ω–∏—Ü = 800 –ö–ë** ‚Üí —á–∏—Ç–∞–µ—Ç—Å—è –∑–∞ 1‚Äì2 –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–∏—Å–∫–∞,  
- **10 000 —Å—Ç—Ä–∞–Ω–∏—Ü = 80 –ú–ë** ‚Üí —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è **—Å–∏–ª—å–Ω–æ –±—å—ë—Ç –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏**.

#### üîπ –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:
> ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º **—Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å—ã > 100 —Å—Ç—Ä–∞–Ω–∏—Ü** ‚Äî —É –º–µ–ª–∫–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å.  
> ‚ùå –ù–µ —Ç—Ä–∞—Ç—å—Ç–µ –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–¥–µ–∫—Å—ã –∏–∑ 5‚Äì10 —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî 50% —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–∞–º ‚Äî –Ω–∏—á—Ç–æ.

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 2. REORGANIZE vs REBUILD

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å **—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞—Ç—ã**:
   ```sql
   SET STATISTICS IO ON;

   SELECT * FROM Orders 
   WHERE OrderDate BETWEEN 
       CAST('2024-01-01' AS date) AND CAST('2024-12-31' AS date);  -- ‚Üê CAST!
   ```

2. –ó–∞–ø–∏—à–∏—Ç–µ `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è`.

3. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ `REORGANIZE`:
   ```sql
   ALTER INDEX IX_Orders_Date ON Orders REORGANIZE;
   ```

4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å ‚Üí –∑–∞–ø–∏—à–∏—Ç–µ `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è`.

5. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ `REBUILD`:
   ```sql
   ALTER INDEX IX_Orders_Date ON Orders REBUILD;
   ```

6. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å ‚Üí —Å—Ä–∞–≤–Ω–∏—Ç–µ –≤—Å–µ 3 –∑–∞–º–µ—Ä–∞.

7. –í –æ—Ç—á—ë—Ç–µ: —Ç–∞–±–ª–∏—Ü–∞:
   | –°—Ü–µ–Ω–∞—Ä–∏–π | `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è` | `–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è` | `ExtFrag, %` | `IntFrag, %` |
   |----------|-----------------------------|---------------------|---------------|---------------|
   | –î–æ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ | ... | ... | ... | ... |
   | –ü–æ—Å–ª–µ REORGANIZE | ... | ... | ... | ... |
   | –ü–æ—Å–ª–µ REBUILD | ... | ... | ... | ... |

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

–ù–∞–ø–∏—à–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã > 100 —Å—Ç—Ä–∞–Ω–∏—Ü,  
- –î–ª—è 10‚Äì30% ‚Üí `REORGANIZE`, –¥–ª—è ‚â•30% ‚Üí `REBUILD`,  
- –í—ã–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—ã (–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç!).

‚úÖ **–ì–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω (—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏)**:
```sql
DECLARE @sql NVARCHAR(MAX) = '';

SELECT @sql += 
    CASE 
        WHEN ips.avg_fragmentation_in_percent >= 30 
        THEN 'ALTER INDEX [' + i.name + '] ON [' + OBJECT_NAME(i.object_id) + '] REBUILD;'
        WHEN ips.avg_fragmentation_in_percent >= 10 
        THEN 'ALTER INDEX [' + i.name + '] ON [' + OBJECT_NAME(i.object_id) + '] REORGANIZE;'
    END + CHAR(13)
FROM sys.dm_db_index_physical_stats(DB_ID(), NULL, NULL, NULL, 'LIMITED') ips
JOIN sys.indexes i ON ips.object_id = i.object_id AND ips.index_id = i.index_id
WHERE ips.page_count > 100 
  AND ips.avg_fragmentation_in_percent >= 10
  AND i.name IS NOT NULL;

PRINT @sql;
-- EXEC sp_executesql @sql;  -- ‚Üê —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏!
```

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 4. –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

1. –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ **¬´–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ varchar –≤ datetime¬ª** –ø—Ä–∏ `'2024-01-01'`?  
2. –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ –≤ `AS [Table]`?  
3. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `REBUILD` –∏ `REORGANIZE` –ø–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º?  
4. –ü–æ—á–µ–º—É –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ < 100 —Å—Ç—Ä–∞–Ω–∏—Ü –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞?

---

## üìÑ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç—á—ë—Ç—É (Word-–¥–æ–∫—É–º–µ–Ω—Ç)**

# –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è: **`–û—Ç—á—ë—Ç_–§–∞–º–∏–ª–∏—è_–ì—Ä—É–ø–ø–∞.docx`**  (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–û—Ç—á—ë—Ç_Petrov_IS-23.docx`)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á—ë—Ç–∞:**

1. **–¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç** (–§–ò–û, –≥—Ä—É–ø–ø–∞, –¥–∞—Ç–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã).  
2. **–¶–µ–ª—å —Ä–∞–±–æ—Ç—ã**.  
3. **–•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:  
   - –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç **—Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞** (—Å –≤–∞—à–µ–π —Ñ–∞–º–∏–ª–∏–µ–π).  
   - **–°–∫—Ä–∏–Ω—à–æ—Ç—ã** –∏–∑ SSMS —Å–æ **–≤—Å–µ–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ SQL-–∫–æ–º–∞–Ω–¥–∞–º–∏** –∏–∑ –∑–∞–¥–∞–Ω–∏–π 1‚Äì4.  
     - –ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã:  
       - –¢–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥—ã(—ã),  
       - –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ (¬´–ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ¬ª),  
       - –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –æ–∫–Ω–∞ –∏–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.  
   - –ü–æ–¥ –∫–∞–∂–¥—ã–º —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º ‚Äî **–ø–æ–¥–ø–∏—Å—å —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º**, –Ω–∞–ø—Ä–∏–º–µ—Ä:  
     > *–†–∏—Å. 1. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ sys.dm_db_index_physical_stats —Å [Table], [Index].*  
     > *–†–∏—Å. 2. –û–∫–Ω–æ ¬´–°–æ–æ–±—â–µ–Ω–∏—è¬ª —Å —á–∏—Å–ª–æ–º –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è = 210.*  
     > *–†–∏—Å. 3. –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ –∏ –ø–æ—Å–ª–µ REBUILD (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è).*  
     > *–†–∏—Å. 4. –í—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.*  
   - **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**:
     | –°—Ü–µ–Ω–∞—Ä–∏–π | `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è` | `–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è` | `ExtFrag, %` | `IntFrag, %` |
     |----------|-----------------------------|---------------------|---------------|---------------|
     | –î–æ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ | 210 | 92 –º—Å | 48.7 | 63.8 |
     | –ü–æ—Å–ª–µ REORGANIZE | 125 | 48 –º—Å | 22.1 | 68.4 |
     | –ü–æ—Å–ª–µ REBUILD | 14 | 8 –º—Å | 0.3 | 94.2 |
   - –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ –∑–∞–¥–∞–Ω–∏—è 4.  
4. **–í—ã–≤–æ–¥**:  
   - –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤—ã —É–∑–Ω–∞–ª–∏ –æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥–∞—Ö –µ—ë —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è?  
   - –° –∫–∞–∫–∏–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏ —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å DMV –∏ –¥–∞—Ç–∞–º–∏?  
   - –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é –≤ production-—Å—Ä–µ–¥–∞—Ö?

> ‚ùó **–í–∞–∂–Ω–æ**:  
> - –û—Ç—á—ë—Ç **–±–µ–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (–∏–ª–∏ –±–µ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)** –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è.  
> - **–ë–µ–∑ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π ExtFrag/IntFrag** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ **–Ω–µ –≤—ã—à–µ ¬´4¬ª**.  
> - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—á—ë—Ç–∫–∏–º–∏ –∏ —á–∏—Ç–∞–µ–º—ã–º–∏**.  
> - –ù–µ –≤—Å—Ç–∞–≤–ª—è–π—Ç–µ –æ–¥–∏–Ω –æ–±—â–∏–π —Å–∫—Ä–∏–Ω—à–æ—Ç –≤—Å–µ–≥–æ –æ–∫–Ω–∞ SSMS ‚Äî –¥–µ–ª–∞–π—Ç–µ **–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º** (DMV, REORGANIZE, REBUILD, —Å–∫—Ä–∏–ø—Ç).

---

## üì§ –°–¥–∞—á–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ñ–æ—Ä–º–∏—Ç–µ –æ—Ç—á—ë—Ç –≤ Microsoft Word.  
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.docx`.  
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ [**Google-—Ñ–æ—Ä–º—É**](https://forms.gle/ZyRB7xgMEPcXqGim7).  
4. –£–∫–∞–∂–∏—Ç–µ –§–ò–û –∏ –≥—Ä—É–ø–ø—É.  
5. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –æ—Ç—á—ë—Ç–∞.  
6. **–°—Ä–æ–∫ —Å–¥–∞—á–∏**: –¥–æ 23:59 **04 –¥–µ–∫–∞–±—Ä—è 2025 –≥.**

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ ¬´5¬ª (–æ—Ç–ª–∏—á–Ω–æ) | –û—Ü–µ–Ω–∫–∞ ¬´4¬ª (—Ö–æ—Ä–æ—à–æ) | –û—Ü–µ–Ω–∫–∞ ¬´3¬ª (—É–¥–æ–≤–ª.) |
|--------|----------------------|---------------------|---------------------|
| **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞** | –ë–î `FragmentLab` —Å–æ–∑–¥–∞–Ω–∞, 50 000 —Å—Ç—Ä–æ–∫ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ, –∏–Ω–¥–µ–∫—Å—ã –∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω—ã | –ï—Å—Ç—å –º–µ–ª–∫–∏–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –≤—Å–µ `INSERT` –≤—ã–ø–æ–ª–Ω–µ–Ω—ã) | –°–∫—Ä–∏–ø—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ |
| **–ó–∞–¥–∞–Ω–∏–µ 1: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | –ó–∞–ø—Ä–æ—Å –∫ DMV –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫ (`[Table]`, `CAST`), –æ–±—ä—è—Å–Ω–µ–Ω—ã ExtFrag/IntFrag | –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π | –û—à–∏–±–∫–∏ 156/242, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω |
| **–ó–∞–¥–∞–Ω–∏–µ 2: REORG/REBUILD** | –ü—Ä–æ–≤–µ–¥–µ–Ω—ã –æ–±–∞ –º–µ—Ç–æ–¥–∞, `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è` –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, —Ç–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–∞—è | –í—ã–ø–æ–ª–Ω–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –∏–ª–∏ –Ω–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è | –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ |
| **–ó–∞–¥–∞–Ω–∏–µ 3: —Å–∫—Ä–∏–ø—Ç** | –°–∫—Ä–∏–ø—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –≤—ã–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—ã, –µ—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –ï—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –Ω–æ –ª–æ–≥–∏–∫–∞ –≤–µ—Ä–Ω–∞ | –°–∫—Ä–∏–ø—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã** | –í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª–Ω—ã–µ, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ—Ä–º–∏–Ω–æ–≤ (ExtFrag, IntFrag, FILLFACTOR) | –û—Ç–≤–µ—Ç—ã –¥–∞–Ω—ã, –Ω–æ 1‚Äì2 ‚Äî –Ω–µ–ø–æ–ª–Ω—ã–µ | –û—Ç–≤–µ—Ç—ã –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| **–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞** | –°–æ–±–ª—é–¥–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≤—Å–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —á—ë—Ç–∫–∏–µ, –ø–æ–¥–ø–∏—Å–∞–Ω—ã, –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è | –ï—Å—Ç—å –º–µ–ª–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π –∫ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º) | –û—Ç—á—ë—Ç –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ—á–∏—Ç–∞–µ–º—ã |

> üí° **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª**: 5  
> ‚ùó **–ë–µ–∑ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–µ –≤—ã—à–µ ¬´4¬ª.

---

### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/LESSON7.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/LESSON8.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–õ–µ–∫—Ü–∏—è ‚Ññ7](../LESSONS/LESSON7.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–õ–µ–∫—Ü–∏—è ‚Ññ8](../LESSONS/LESSON8.MD) |

---

### 🔙 📚 🔜 Навигация по курсу

| [Предыдущее занятие](../LESSONS/LESSON6.MD) | &nbsp; | [Следующее занятие](../LESSONS/LESSON7.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| 🏠 [Лекция №6](../LESSONS/LESSON6.MD) | 📖 [Содержание](../README.MD) | 💻 [Лекция №7](../LESSONS/LESSON7.MD) |

---

# Практическая работа №5  
## Схемы в MS SQL Server: логическая изоляция и управление правами

> **Цель**: Научиться создавать пользовательские схемы, использовать их для логической изоляции подсистем и управлять правами на уровне схемы.  
> **Продолжительность**: 2 академических часа  
> **Оборудование**: Виртуальная машина с MS SQL Server Developer Edition и SSMS

---

## 📥 Шаг 0. Стартовый скрипт (выполните целиком)

> 💡 **Замените `Ivanov` на свою фамилию!**

```sql
-- Создаём учебную базу
CREATE DATABASE UniversityDB_Ivanov;
GO

USE UniversityDB_Ivanov;
GO

-- Создаём схемы для разных подсистем
CREATE SCHEMA academy;
CREATE SCHEMA hr;
GO

-- Таблицы уже разработаны — мы их развёртываем
CREATE TABLE academy.Students (
    StudentID int PRIMARY KEY,
    FirstName nvarchar(50),
    LastName nvarchar(50)
);

CREATE TABLE hr.Employees (
    EmployeeID int PRIMARY KEY,
    FullName nvarchar(100),
    Position nvarchar(50)
);
GO

-- Добавляем тестовые данные
INSERT INTO academy.Students VALUES
(1, N'Анна', N'Петрова'),
(2, N'Иван', N'Сидоров');

INSERT INTO hr.Employees VALUES
(101, N'Смирнов А.В.', N'Директор'),
(102, N'Кузнецова М.П.', N'Бухгалтер');
GO
```

---

## 📋 Задание 1. Работа с правами на уровне схемы

1. Создайте **логин** `analyst_login` с паролем `Pass123!`.  
2. Создайте пользователя `analyst_user` в базе `UniversityDB_Фамилия`.  
3. **Дайте пользователю право читать все таблицы в схеме `academy` одной командой**.  
4. Проверьте, что пользователь **не видит** таблицу `hr.Employees`.

> 💡 Подсказка: используйте `GRANT SELECT ON SCHEMA::...`

---

## 📋 Задание 2. Изоляция подсистем

1. Создайте **логин** `hr_intern_login` с паролем `Pass456!`.  
2. Создайте пользователя `hr_intern_user`.  
3. Дайте ему право **только на схему `hr`** (чтение и вставка).  
4. Попытайтесь (мысленно или в SSMS под этим логином) выполнить:
   ```sql
   SELECT * FROM academy.Students;
   ```
   → Что произойдёт? Почему?

---

## 📋 Задание 3. Диагностика схем

Выполните запросы и включите результаты в отчёт:

1. Список всех схем в базе:
   ```sql
   SELECT name AS SchemaName FROM sys.schemas;
   ```

2. Список таблиц с указанием схемы:
   ```sql
   SELECT 
       s.name AS SchemaName,
       t.name AS TableName
   FROM sys.tables t
   JOIN sys.schemas s ON t.schema_id = s.schema_id;
   ```

---

## 📋 Задание 4. Ответы на вопросы (в отчёте)

1. Почему важно использовать схемы в крупных информационных системах?  
2. В чём преимущество `GRANT SELECT ON SCHEMA::academy` перед выдачей прав на каждую таблицу?  
3. Что произойдёт, если попытаться удалить схему `academy`, не удалив таблицу `academy.Students`?  
4. Может ли один пользователь иметь разные права в разных схемах? Приведите пример.

---

## 📄 **Требования к отчёту (Word-документ)**

# Файл должен называться: **`Отчёт_Фамилия_Группа.docx`**  (например, `Отчёт_Petrov_IS-23.docx`)

**Структура отчёта:**

1. **Титульный лист** (ФИО, группа, дата, название работы).  
2. **Цель работы**.  
3. **Ход выполнения**:  
   - Полный текст **стартового скрипта** (с вашей фамилией).  
   - **Скриншоты** из SSMS со **всеми выполненными SQL-командами** из заданий 1–4.  
     - На скриншоте должны быть видны:  
       - Текст команды(ы),  
       - Сообщение об успешном выполнении («Commands completed successfully»),  
       - Имя базы данных в заголовке окна или в строке состояния (если возможно).  
   - Под каждым скриншотом — **подпись с пояснением**, например:  
     > *Рис. 1. Создание логинов reader_login и editor_login.*  
   - Альтернатива (если скриншоты сделать сложно):  
     - Текст всех выполненных команд **с комментариями**, например:  
       ```sql
       -- Создаём логин для читателя
       CREATE LOGIN reader_login WITH PASSWORD = 'Pass123!';
       ```  
     - Но **предпочтительны скриншоты**, так как они подтверждают фактическое выполнение.  
   - Ответы на вопросы из задания 5.  
4. **Вывод**:  
   - Что нового вы узнали?  
   - С какими трудностями столкнулись?  
   - Почему важно разделять права доступа в базах данных?

> ❗ **Важно**:  
> - Отчёт **без скриншотов (или без альтернативного кода с комментариями)** не принимается.  
> - Скриншоты должны быть **чёткими и читаемыми** (можно использовать инструмент «Ножницы» или `Win + Shift + S`).  
> - Не вставляйте один общий скриншот всего окна SSMS — делайте **отдельные скриншоты по логическим блокам** (логины, пользователи, роли, привилегии).

---

## 📤 Сдача работы

1. Оформите отчёт в Microsoft Word.  
2. Сохраните файл в формате `.docx`.  
3. Перейдите по ссылке на **Google-форму** (получите у преподавателя).  
4. Укажите ФИО и группу.  
5. Загрузите файл отчёта.  
6. **Срок сдачи**: до 10 ноября 2025 г.

---

## 📊 Критерии оценивания

| Критерий | Оценка «5» (отлично) | Оценка «4» (хорошо) | Оценка «3» (удовл.) |
|--------|----------------------|---------------------|---------------------|
| **Выполнение стартового скрипта** | Скрипт выполнен, фамилия заменена, все объекты созданы | Скрипт выполнен, но есть мелкие ошибки (например, не заменена фамилия) | Скрипт не выполнен или содержит критические ошибки |
| **Задание 1: права на схему** | Корректно созданы логин, пользователь и выданы права на схему одной командой | Права выданы, но использованы отдельные команды на каждую таблицу | Права не выданы или выданы с ошибками |
| **Задание 2: изоляция подсистем** | Пользователь создан, права на схему `hr` выданы, изоляция от `academy` объяснена верно | Права выданы, но объяснение изоляции неполное | Права не выданы или пользователь имеет доступ к обеим схемам |
| **Задание 3: диагностика** | Оба запроса выполнены, результаты включены в отчёт | Один из запросов отсутствует или содержит ошибку | Запросы не выполнены |
| **Ответы на вопросы** | Все ответы полные, точные, демонстрируют понимание | Ответы даны, но 1–2 — неполные | Ответы поверхностные или отсутствуют |
| **Оформление отчёта** | Соблюдена структура, все скриншоты чёткие, подписаны, есть вывод | Есть мелкие нарушения оформления (например, нет подписей) | Отчёт неструктурирован, скриншоты отсутствуют или нечитаемы |

> 💡 **Максимальный балл**: 5  
> ❗ **Без скриншотов** — максимальная оценка не выше «3».


---

### 🔙 📚 🔜 Навигация по курсу

| [Предыдущее занятие](../LESSONS/LESSON6.MD) | &nbsp; | [Следующее занятие](../LESSONS/LESSON7.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| 🏠 [Лекция №6](../LESSONS/LESSON6.MD) | 📖 [Содержание](../README.MD) | 💻 [Лекция №7](../LESSONS/LESSON7.MD) |

---

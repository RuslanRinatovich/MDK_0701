### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR7.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR8.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ7](../LESSONS/PR7.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ8](../LESSONS/PR8.MD) |

---

üéì **–õ–µ–∫—Ü–∏—è 8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤: –∫–∞–∫ SQL Server –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω –∏ –ø–æ—á–µ–º—É –æ–Ω –æ—à–∏–±–∞–µ—Ç—Å—è**  
‚è±Ô∏è **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 90 –º–∏–Ω—É—Ç  
üéØ **–¶–µ–ª—å –ª–µ–∫—Ü–∏–∏**:  
–ü–æ–Ω—è—Ç—å **–Ω–∞ –ø–∞–ª—å—Ü–∞—Ö**, —á—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, **–∫–∞–∫ –∏–º–µ–Ω–Ω–æ** –æ–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä –ø–ª–∞–Ω–∞, –∏ **–ø–æ—á–µ–º—É —É—Å—Ç–∞—Ä–µ–≤—à–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–º–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ, –∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å 15 000 —Å—Ç—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç –≤ –ü—Ä–∞–∫—Ç–∏–∫–µ ‚Ññ8.

---

## üìñ –ß–∞—Å—Ç—å 0. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –∑–∞–ø–æ–º–Ω–∏—Ç–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞

> üí° **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî —ç—Ç–æ –ù–ï –æ—Ç—á—ë—Ç. –≠—Ç–æ ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª SQL Server‚Äô–∞.**  
>  
> –í —ç—Ç–æ–º ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫–µ¬ª –∑–∞–ø–∏—Å–∞–Ω–æ:  
> - –°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ,  
> - –ö–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö,  
> - –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∏–º–µ—é—Ç `CustomerID = 42`,  
> - –ö–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–∞—Ç—ã, —Å—É–º–º—ã, —Å—Ç–∞—Ç—É—Å—ã‚Ä¶  
>  
> **SQL Server —Å–º–æ—Ç—Ä–∏—Ç –≤ —ç—Ç–æ—Ç ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª –ü–ï–†–ï–î –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º** –∏ –Ω–∞ –µ–≥–æ –æ—Å–Ω–æ–≤–µ —Ä–µ—à–∞–µ—Ç:  
> *¬´–ë—É–¥—É –∏—Å–∫–∞—Ç—å –ø–æ –∏–Ω–¥–µ–∫—Å—É (Seek) –∏–ª–∏ —á–∏—Ç–∞—Ç—å –≤—Å—é —Ç–∞–±–ª–∏—Ü—É (Scan)?  
> –ë—É–¥—É –¥–µ–ª–∞—Ç—å `Nested Loops` –∏–ª–∏ `Hash Match`?¬ª*  
>  
> **–ï—Å–ª–∏ ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª —É—Å—Ç–∞—Ä–µ–ª ‚Äî —Ä–µ—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º ‚Üí –∑–∞–ø—Ä–æ—Å —Ç–æ—Ä–º–æ–∑–∏—Ç.**

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞? –ß—ë—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

### üîπ –§–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞):
> **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (Statistics)** ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π **–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É** –∏ **–ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** –∑–Ω–∞—á–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –∏–Ω–¥–µ–∫—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ **–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** (—á–∏—Å–ª–∞ —Å—Ç—Ä–æ–∫) –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

> –ú–µ—Ö–∞–Ω–∏–∑–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–æ–π**. –ü–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–º—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–æ–π —è–≤–ª—è–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö; –æ–¥–Ω–∞–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª–µ–µ –æ–±—â–∏–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–º—ã—Å–ª —ç—Ç–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞.

### üîπ –ü—Ä–æ—Å—Ç–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è):
> **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî —ç—Ç–æ ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª, –≤ –∫–æ—Ç–æ—Ä–æ–º SQL Server –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç:**  
> *¬´–í —Å—Ç–æ–ª–±—Ü–µ `CustomerID`:  
> ‚Äî –≤—Å–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–π: 100 000,  
> ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: 200,  
> ‚Äî `CustomerID = 42` –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è 15 000 —Ä–∞–∑,  
> ‚Äî `CustomerID = 77` ‚Äî 1 —Ä–∞–∑,  
> ‚Äî 90% –∑–Ω–∞—á–µ–Ω–∏–π ‚Äî –æ—Ç 1 –¥–æ 100‚Ä¶¬ª*  
>  
> –≠—Ç–æ—Ç ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–∞ –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ —Å—Ç–æ–ª–±—Ü—É (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ `Auto Create Statistics`).

---

## üîç –≠—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—é –∏–ª–∏ –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º —Ç–∞–±–ª–∏—Ü—ã?

> üí° **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–∂–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É ‚Äî –∏ —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–ª–∞–Ω–æ–≤.**

### ‚úÖ 3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ SQL Server:

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è | –ü–æ –∫–∞–∫–∏–º —Å—Ç–æ–ª–±—Ü–∞–º | –ü—Ä–∏–º–µ—Ä |
|----------|-----------------|-------------------|--------|
| **1. –ü–æ –∏–Ω–¥–µ–∫—Å—É** | –ü—Ä–∏ `CREATE INDEX` | **–¢–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á—É –∏–Ω–¥–µ–∫—Å–∞** (–Ω–µ –ø–æ `INCLUDE`!) | `CREATE INDEX IX ON T(A) INCLUDE (B)` ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ **—Ç–æ–ª—å–∫–æ –ø–æ `A`** |
| **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è** | –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ —Å—Ç–æ–ª–±—Ü—É –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | **–ü–æ –æ–¥–Ω–æ–º—É —Å—Ç–æ–ª–±—Ü—É** –∏–∑ `WHERE`, `JOIN`, `GROUP BY` | `SELECT * FROM T WHERE B = 1` ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è `_WA_Sys_...` –ø–æ `B` |
| **3. –†—É—á–Ω–∞—è** | –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `CREATE STATISTICS` | **–ü–æ –ª—é–±—ã–º 1‚Äì32 —Å—Ç–æ–ª–±—Ü–∞–º** | `CREATE STATISTICS S ON T(A, B)` ‚Üí –ø–æ –ø–∞—Ä–µ `(A, B)` |

---

### üîé –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

#### 1. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É**
```sql
CREATE NONCLUSTERED INDEX IX_Orders_Customer 
ON Orders(CustomerID)          -- ‚Üê –∫–ª—é—á
INCLUDE (OrderDate, Amount);   -- ‚Üê INCLUDE
```
‚Üí –°–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –∏–º–µ–Ω–µ–º **`IX_Orders_Customer`**,  
‚Üí –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ `CustomerID`**,  
‚Üí `OrderDate`, `Amount` **–Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ** ‚Äî –æ–Ω–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è `SELECT`.

> üí° **–ü–æ—á–µ–º—É —Ç–∞–∫?**  
> –ü–æ—Ç–æ–º—É —á—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –ø–æ —É—Å–ª–æ–≤–∏—é**, –∞ —É—Å–ª–æ–≤–∏–µ ‚Äî –ø–æ –∫–ª—é—á—É –∏–Ω–¥–µ–∫—Å–∞. `INCLUDE` –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ, *–Ω—É–∂–Ω–æ –ª–∏ –∏–¥—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—É*.

---

#### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–∞:  
```sql
SELECT is_auto_create_stats_on 
FROM sys.databases 
WHERE name = 'StatsLab';  -- 1 = ON
```

**–ü—Ä–∏–º–µ—Ä**:  
```sql
SELECT * FROM Orders WHERE Status = 'new';  -- ‚Üê Status –ù–ï –≤ –∏–Ω–¥–µ–∫—Å–µ
```
‚Üí SQL Server —Å–æ–∑–¥–∞—ë—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**:  
```text
_WA_Sys_00000003_00000001
```
‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî **—Ç–æ–ª—å–∫–æ –ø–æ `Status`**,  
‚Üí –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —Å `'new'`, –¥–∞–∂–µ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞.

> ‚úÖ **–≠—Ç–æ —Å–ø–∞—Å–∞–µ—Ç –æ—Ç –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**, –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–∞ –Ω–µ—Ç.

---

#### 3. **–†—É—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
–ö–æ–≥–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π):
```sql
CREATE STATISTICS Stats_Customer_Status 
ON Orders(CustomerID, Status);
```
‚Üí –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç –ø–æ **–ø–∞—Ä–µ `(CustomerID, Status)`**,  
‚Üí –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö:  
```sql
WHERE CustomerID = 42 AND Status = 'active'
```

---

### üìä –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –µ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ?
```sql
SELECT 
    s.name AS StatName,
    COL_NAME(s.object_id, sc.column_id) AS ColumnName,
    CASE WHEN s.auto_created = 1 THEN '–ê–≤—Ç–æ' 
         WHEN s.user_created = 1 THEN '–†—É—á–Ω–∞—è' 
         ELSE '–ü–æ –∏–Ω–¥–µ–∫—Å—É' END AS Type,
    STATS_DATE(s.object_id, s.stats_id) AS LastUpdate
FROM sys.stats s
JOIN sys.stats_columns sc ON s.stats_id = sc.stats_id 
WHERE s.object_id = OBJECT_ID('Orders');
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö**:
- `_WA_Sys_...` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è,  
- `IX_...` ‚Üí –ø–æ –∏–Ω–¥–µ–∫—Å—É,  
- `Stats_...` ‚Üí —Ä—É—á–Ω–∞—è.

---

### üí° –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤?

1. **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ ‚Äî –Ω–µ –∑–Ω–∞—á–∏—Ç ¬´–Ω–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏¬ª**.  
   ‚Üí –î–∞–∂–µ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ SQL Server –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å `Index Seek`, –µ—Å–ª–∏ –µ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.

2. **INCLUDE-—Å—Ç–æ–ª–±—Ü—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**.  
   ‚Üí –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç–µ –ø–æ `Status`, –Ω–æ –∏–Ω–¥–µ–∫—Å ‚Äî `ON (CustomerID) INCLUDE (Status)`, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç **–ø–æ `CustomerID`**, –∞ –Ω–µ –ø–æ `Status` ‚Üí –æ—Ü–µ–Ω–∫–∞ –±—É–¥–µ—Ç –Ω–µ—Ç–æ—á–Ω–æ–π.

3. **–°–æ—Å—Ç–∞–≤–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ç—Ä–µ–±—É—é—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**.  
   ‚Üí –î–ª—è `WHERE A = 1 AND B = 2` –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å `STATISTICS ON (A, B)`, —á–µ–º –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ.

---

## 2. –ö–∞–∫ SQL Server –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? –ü–æ—à–∞–≥–æ–≤–æ

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ: –≤—ã ‚Äî –¥–∏—Å–ø–µ—Ç—á–µ—Ä —Ç–∞–∫—Å–∏. –ö –≤–∞–º –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–∫–∞–∑: *¬´–ó–∞–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 42¬ª*.

### üîπ –í–∞—Ä–∏–∞–Ω—Ç 1: –£ –≤–∞—Å –µ—Å—Ç—å **–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –≥–æ—Ä–æ–¥–∞**
- –í—ã –≤–∏–¥–∏—Ç–µ: *¬´—É–ª. –õ–µ–Ω–∏–Ω–∞ ‚Äî —Ü–µ–Ω—Ç—Ä, –ø—Ä–æ–±–∫–∏ —Å 17:00 –¥–æ 19:00¬ª*,  
- –†–µ—à–∞–µ—Ç–µ: *¬´–ü–æ—à–ª—é –ú–∏—Ö–∞–ª—ã—á–∞ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–µ ‚Äî –æ–Ω –ø—Ä–æ–µ–¥–µ—Ç –ø–æ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–æ–ª–æ—Å–µ¬ª*.  
‚Üí –ö–ª–∏–µ–Ω—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∑–∞ 8 –º–∏–Ω—É—Ç.

### üîπ –í–∞—Ä–∏–∞–Ω—Ç 2: –£ –≤–∞—Å **—É—Å—Ç–∞—Ä–µ–≤—à–∞—è –∫–∞—Ä—Ç–∞** (2010 –≥–æ–¥–∞)
- –í –∫–∞—Ä—Ç–µ: *¬´—É–ª. –õ–µ–Ω–∏–Ω–∞ ‚Äî —Ç–∏—Ö–∞—è –æ–∫—Ä–∞–∏–Ω–∞, –±–µ–∑ –ø—Ä–æ–±–æ–∫¬ª*,  
- –í—ã —Ä–µ—à–∞–µ—Ç–µ: *¬´–ü–æ—à–ª—é –í–∞—Å–∏–ª–∏—è –Ω–∞ –æ–±—ã—á–Ω–æ–π ¬´–õ–∞–¥–µ¬ª ‚Äî –±—ã—Å—Ç—Ä–æ –¥–æ–µ–¥–µ—Ç¬ª*,  
- –ù–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ ‚Äî **–ø—Ä–æ–±–∫–∞ 2 –∫–º**,  
‚Üí –ö–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç 42 –º–∏–Ω—É—Ç—ã.

üîπ **SQL Server ‚Äî –∫–∞–∫ —ç—Ç–æ—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä.**  
üîπ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî –∫–∞–∫ –∫–∞—Ä—Ç–∞ –≥–æ—Ä–æ–¥–∞.**  
üîπ **`UPDATE STATISTICS` ‚Äî –∫–∞–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã.**

---

## 3. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä: 1 —Å—Ç—Ä–æ–∫–∞ vs 15 000 —Å—Ç—Ä–æ–∫ (—è–¥—Ä–æ –ª–µ–∫—Ü–∏–∏)

### üìã –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –¢–∞–±–ª–∏—Ü–∞ `Orders` ‚Äî 100 000 —Å—Ç—Ä–æ–∫,  
- –ò–Ω–¥–µ–∫—Å: `IX_Orders_Customer (CustomerID)`,  
- –†–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:  
  - `CustomerID = 42` ‚Üí **15 000 —Å—Ç—Ä–æ–∫**,  
  - `CustomerID = 77` ‚Üí **1 —Å—Ç—Ä–æ–∫–∞**.

–ó–∞–ø—Ä–æ—Å:
```sql
SELECT OrderID, Amount FROM Orders WHERE CustomerID = 42;
```

---

### ‚ùå –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞ ‚Üí SQL Server ¬´–¥—É–º–∞–µ—Ç¬ª, —á—Ç–æ 1 —Å—Ç—Ä–æ–∫–∞

#### –®–∞–≥ 1. ¬´–ú—ã—Å–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å¬ª –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞:
> ‚Äî –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –ø–æ `CustomerID = 42`.  
> ‚Äî –û—Ç–∫—Ä—ã–≤–∞—é ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª ‚Üí —Ç–∞–º –Ω–∞–ø–∏—Å–∞–Ω–æ: **1 —Å—Ç—Ä–æ–∫–∞**.  
> ‚Äî –î–ª—è **1 —Å—Ç—Ä–æ–∫–∏** —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±:  
>   1. –ù–∞–π—Ç–∏ –µ—ë –ø–æ –∏–Ω–¥–µ–∫—Å—É (`Index Seek`),  
>   2. –î–æ–±–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç–æ–ª–±—Ü—ã (`OrderID`, `Amount`) —á–µ—Ä–µ–∑ `Key Lookup`.  
> ‚Äî –ü–∞–º—è—Ç–∏ –Ω—É–∂–Ω–æ –º–∞–ª–æ ‚Üí –≤—ã–±–∏—Ä–∞—é `Nested Loops`.

#### –®–∞–≥ 2. –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—á—Ç–æ —É–≤–∏–¥–∏—Ç —Å—Ç—É–¥–µ–Ω—Ç –≤ SSMS):
```
SELECT  
‚Üë  
–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã (0%)  
‚îú‚îÄ –ü–æ–∏—Å–∫ –≤ –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º –∏–Ω–¥–µ–∫—Å–µ [IX_Orders_Customer] (5%)  
‚îî‚îÄ –£—Ç–æ—á–Ω—è—é—â–∏–π –∑–∞–ø—Ä–æ—Å RID (–∫—É—á–∞) [Orders] (95%)
```

#### –®–∞–≥ 3. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏:
- `–ü–æ–∏—Å–∫ –≤ –∏–Ω–¥–µ–∫—Å–µ` –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç **15 000 —É–∫–∞–∑–∞—Ç–µ–ª–µ–π**,  
- –ù–æ –∑–∞—Ç–µ–º ‚Äî **15 000 —Ä–∞–∑**:  
  ‚Üí ¬´–ø–æ—à—ë–ª –≤ –∏–Ω–¥–µ–∫—Å ‚Üí –≤–∑—è–ª —É–∫–∞–∑–∞—Ç–µ–ª—å ‚Üí –ø–æ—à—ë–ª –≤ —Ç–∞–±–ª–∏—Ü—É ‚Üí –≤—ã—á–∏—Ç–∞–ª —Å—Ç—Ä–æ–∫—É¬ª,  
- –≠—Ç–æ **15 000 —Å–ª—É—á–∞–π–Ω—ã—Ö —á—Ç–µ–Ω–∏–π —Å –¥–∏—Å–∫–∞** ‚Üí –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ.

#### –®–∞–≥ 4. –†–µ–∑—É–ª—å—Ç–∞—Ç (–∏–∑ ¬´–°–æ–æ–±—â–µ–Ω–∏–π¬ª):
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| `–û—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–æ–∫` | 1 |
| `–§–∞–∫—Ç —Å—Ç—Ä–æ–∫` | 15 000 |
| `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è` | 30 200 |
| `–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è` | 5.8 —Å–µ–∫ |

> üí° **–ü–æ—á–µ–º—É 95% —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É ¬´–£—Ç–æ—á–Ω—è—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞¬ª?**  
> –ü–æ—Ç–æ–º—É —á—Ç–æ 15 000 —Å–ª—É—á–∞–π–Ω—ã—Ö —á—Ç–µ–Ω–∏–π ‚Äî —ç—Ç–æ **–≤ 100 —Ä–∞–∑ –¥–æ—Ä–æ–∂–µ** –æ–¥–Ω–æ–≥–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ.

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞ ‚Üí SQL Server –∑–Ω–∞–µ—Ç: 15 000 —Å—Ç—Ä–æ–∫

#### –®–∞–≥ 1. ¬´–ú—ã—Å–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å¬ª –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞:
> ‚Äî –í ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫–µ¬ª –Ω–∞–ø–∏—Å–∞–Ω–æ: **15 000 —Å—Ç—Ä–æ–∫**.  
> ‚Äî `Nested Loops` —Å 15 000 Key Lookup‚Äô–∞–º–∏ ‚Äî –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞.  
> ‚Äî –õ—É—á—à–µ:  
>   1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ 15 000 —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥,  
>   2. –°–æ–±—Ä–∞—Ç—å –∏—Ö –≤ —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—É,  
>   3. –û–¥–∏–Ω —Ä–∞–∑ —Å—Ö–æ–¥–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É –±–ª–æ–∫–∞–º–∏ ‚Üí `Hash Match`.

#### –®–∞–≥ 2. –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```
SELECT  
‚Üë  
Hash Match (Inner Join) (100%)  
‚îú‚îÄ –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ [IX_Orders_Customer] (10%)  
‚îî‚îÄ –£—Ç–æ—á–Ω—è—é—â–∏–π –∑–∞–ø—Ä–æ—Å RID (–∫—É—á–∞) [Orders] (90%)
```

#### –®–∞–≥ 3. –†–µ–∑—É–ª—å—Ç–∞—Ç:
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| `–û—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–æ–∫` | 15 000 |
| `–§–∞–∫—Ç —Å—Ç—Ä–æ–∫` | 15 000 |
| `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è` | 1 400 |
| `–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è` | 0.7 —Å–µ–∫ |

‚Üí **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 8.3 —Ä–∞–∑–∞** ‚Äî —Ç–æ–ª—å–∫–æ –∑–∞ —Å—á—ë—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

---

### üåü –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò–¥–µ–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω ‚Äî –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π –∏–Ω–¥–µ–∫—Å

#### –®–∞–≥ 1. –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å:
```sql
CREATE NONCLUSTERED INDEX IX_Cover 
ON Orders(CustomerID) INCLUDE (OrderID, Amount);
```

#### –®–∞–≥ 2. –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```
SELECT  
‚Üë  
–ü–æ–∏—Å–∫ –≤ –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º –∏–Ω–¥–µ–∫—Å–µ [IX_Cover] (100%)
```

#### –®–∞–≥ 3. –†–µ–∑—É–ª—å—Ç–∞—Ç:
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| `–û—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–æ–∫` | 15 000 |
| `–§–∞–∫—Ç —Å—Ç—Ä–æ–∫` | 15 000 |
| `–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è` | 120 |
| `–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è` | 0.09 —Å–µ–∫ |

‚Üí **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 64 —Ä–∞–∑–∞** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

---

## 4. –ö–∞–∫ —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–±–ª–µ–º—É? –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### üîπ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ SSMS:
1. –í–∫–ª—é—á–∏ **`Ctrl + M`** (–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è),  
2. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å,  
3. –ö–ª–∏–∫–Ω–∏ –ø–æ –ª—é–±–æ–º—É –æ–ø–µ—Ä–∞—Ç–æ—Ä—É ‚Üí –≤–Ω–∏–∑—É –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞.

### üîπ –ß—Ç–æ –∏—Å–∫–∞—Ç—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!):
| –ù–∞–∑–≤–∞–Ω–∏–µ –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ | –ß—Ç–æ —ç—Ç–æ | –ù–æ—Ä–º–∞ | –¢—Ä–µ–≤–æ–≥–∞ |
|----------------------|---------|-------|---------|
| **Estimated Number of Rows** | –û—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–æ–∫ | ‚âà —Ñ–∞–∫—Ç—É | << —Ñ–∞–∫—Ç–∞ |
| **Actual Number of Rows** | –§–∞–∫—Ç —Å—Ç—Ä–æ–∫ | ‚Äî | ‚Äî |
| **Estimated I/O Cost** | –û—Ü–µ–Ω–∫–∞ —á—Ç–µ–Ω–∏–π | ‚Äî | >> —Ñ–∞–∫—Ç–∞ |
| **Actual I/O Cost** | –§–∞–∫—Ç —á—Ç–µ–Ω–∏–π | ‚Äî | ‚Äî |

> ‚úÖ **–ü—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤**:  
> **–ï—Å–ª–∏ `–û—Ü–µ–Ω–∫–∞` < `–§–∞–∫—Ç` –≤ 10+ —Ä–∞–∑ ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞. –ù—É–∂–Ω–æ `UPDATE STATISTICS`.**

---

## 5. –ü–æ—á–µ–º—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç? 3 –ø—Ä–∏—á–∏–Ω—ã –∏–∑ –∂–∏–∑–Ω–∏

| –ü—Ä–∏—á–∏–Ω–∞ | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ ¬´–±–ª–æ–∫–Ω–æ—Ç–∏–∫–æ–º¬ª | –ü—Ä–∏–º–µ—Ä –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏ |
|--------|-------------------------------|-------------------|
| **1. –ú–∞—Å—Å–æ–≤—ã–π INSERT** | –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–µ | –ò–º–ø–æ—Ä—Ç 50 000 –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí –¥–ª—è `CustomerID = 2000` –æ—Ü–µ–Ω–∫–∞ = 1, —Ñ–∞–∫—Ç = 50 000 |
| **2. –ú–∞—Å—Å–æ–≤—ã–π DELETE** | –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Å—Ç–∞–ª–∏—Å—å –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ | –£–¥–∞–ª–µ–Ω–∏–µ 90% ¬´—Ç–µ—Å—Ç–æ–≤—ã—Ö¬ª —Å—Ç—Ä–æ–∫ ‚Üí –æ—Ü–µ–Ω–∫–∞ –¥–ª—è `Status = 'test'` = 10 000, —Ñ–∞–∫—Ç = 0 |
| **3. UPDATE –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π** | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑–º–µ–Ω–∏–ª–æ—Å—å | –ü–µ—Ä–µ–≤–æ–¥ 20 000 –∑–∞–∫–∞–∑–æ–≤ –∏–∑ `Status = 'new'` –≤ `'active'` ‚Üí –æ—Ü–µ–Ω–∫–∞ –¥–ª—è `'active'` = 5 000, —Ñ–∞–∫—Ç = 25 000 |

> üìå **–ü–æ—á–µ–º—É –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å–ø–∞—Å–∞–µ—Ç?**  
> ‚Äî –ü—Ä–∏ 1 –º–ª–Ω —Å—Ç—Ä–æ–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ **200 000 –∏–∑–º–µ–Ω–µ–Ω–∏–π**,  
> ‚Äî –ù–æ —É–∂–µ –ø–æ—Å–ª–µ 10 000 –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ç–æ—Ä–º–æ–∑–∏—Ç—å.

---

## 6. –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? 3 —É—Ä–æ–≤–Ω—è —Ç–æ—á–Ω–æ—Å—Ç–∏

| –ö–æ–º–∞–Ω–¥–∞ | –¢–æ—á–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|--------|----------|----------|-------------------|
| `UPDATE STATISTICS Orders;` | –°—Ä–µ–¥–Ω—è—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ~30 000 —Å—Ç—Ä–æ–∫) | –ë—ã—Å—Ç—Ä–æ | –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ |
| `UPDATE STATISTICS Orders IX_Name WITH SAMPLE 50 PERCENT;` | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ | –ü–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –æ—Ç—á—ë—Ç–∞–º–∏ |
| `UPDATE STATISTICS Orders IX_Name WITH FULLSCAN;` | 100% | –ú–µ–¥–ª–µ–Ω–Ω–æ | –ù–æ—á—å—é –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü |

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**:  
> - `REBUILD` –∏–Ω–¥–µ–∫—Å–∞ ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ **–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**,  
> - `REORGANIZE` ‚Üí **–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç** ‚Üí –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å `UPDATE STATISTICS` –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## 7. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è: –∫–∞–∫ –Ω–µ –∑–∞–±—ã—Ç—å?

### üîπ –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–≤–µ—Ä–∏—Ç—å—Å—è SQL Server (—Ä–∏—Å–∫ –µ—Å—Ç—å)
```sql
-- –í–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
ALTER DATABASE StatsLab SET AUTO_UPDATE_STATISTICS ON;
```

### üîπ –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –°–æ–∑–¥–∞–π **–ó–∞–¥–∞–Ω–∏–µ (Job)** –≤ SQL Server Agent,  
2. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00,  
3. –®–∞–≥:
   ```sql
   -- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –ë–î
   EXEC sp_updatestats;
   ```

> üí° `sp_updatestats` –æ–±–Ω–æ–≤–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ —É—Å—Ç–∞—Ä–µ–≤—à—É—é** —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞.

---

## 8. –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å –æ—Ç–≤–µ—Ç–∞–º–∏)

1. **–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞?**  
   ‚Üí ¬´–ë–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö.

2. **–ü–æ—á–µ–º—É –ø—Ä–∏ `–û—Ü–µ–Ω–∫–∞ = 1`, `–§–∞–∫—Ç = 15 000` –∑–∞–ø—Ä–æ—Å —Ç–æ—Ä–º–æ–∑–∏—Ç?**  
   ‚Üí SQL Server –≤—ã–±–∏—Ä–∞–µ—Ç `Nested Loops` + 15 000 Key Lookup‚Äô–æ–≤ –≤–º–µ—Å—Ç–æ `Hash Match`.

3. **–ß–µ–º `REBUILD` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `REORGANIZE` –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ?**  
   ‚Üí `REBUILD` –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, `REORGANIZE` ‚Äî –Ω–µ—Ç.

4. **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —É—Å—Ç–∞—Ä–µ–ª–∞ –ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞?**  
   ‚Üí –°—Ä–∞–≤–Ω–∏—Ç—å `–û—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–æ–∫` –∏ `–§–∞–∫—Ç —Å—Ç—Ä–æ–∫` –≤ ¬´–ü–ª–∞–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è¬ª.

5. **–ü–æ—á–µ–º—É `WITH FULLSCAN` –º–µ–¥–ª–µ–Ω–Ω—ã–π?**  
   ‚Üí SQL Server –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—Ç **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏** –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–¥–µ–∞–ª—å–Ω–æ–π –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã.

---

## 9. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ ‚Äî 7 –∫–ª—é—á–µ–≤—ã—Ö –º—ã—Å–ª–µ–π

1. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî —ç—Ç–æ ¬´–º–æ–∑–≥¬ª –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞. –ë–µ–∑ –Ω–µ—ë ‚Äî —Å–ª–µ–ø–æ–π —Ä–∞—Å—á—ë—Ç.**  
2. **–û—Ü–µ–Ω–∫–∞ —Å—Ç—Ä–æ–∫ ‚Üí –≤—ã–±–æ—Ä –ø–ª–∞–Ω–∞. –§–∞–∫—Ç —Å—Ç—Ä–æ–∫ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç–∏.**  
3. **–û—Ü–µ–Ω–∫–∞ << –§–∞–∫—Ç ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞ ‚Üí `UPDATE STATISTICS`.**  
4. **Key Lookup –Ω–∞ 15 000 —Å—Ç—Ä–æ–∫ ‚Äî –≥–ª–∞–≤–Ω—ã–π ¬´—Ç–æ—Ä–º–æ–∑¬ª –ø—Ä–∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.**  
5. **`REBUILD` = —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞, `REORGANIZE` = —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ù–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∞.**  
6. **–ü–æ–∫—Ä—ã–≤–∞—é—â–∏–π –∏–Ω–¥–µ–∫—Å + –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.**  
7. **`UPDATE STATISTICS` ‚Äî —Å–∞–º–∞—è –¥–µ—à—ë–≤–∞—è –∏ –º–æ—â–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤ –∞—Ä—Å–µ–Ω–∞–ª–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.**

---

## üîú –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ8** –≤—ã:  
- —Å–æ–∑–¥–∞–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `Orders`,  
- –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ ¬´–∏—Å–ø–æ—Ä—Ç–∏—Ç–µ¬ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É,  
- —É–≤–∏–¥–∏—Ç–µ, –∫–∞–∫ `–û—Ü–µ–Ω–∫–∞ = 1`, `–§–∞–∫—Ç = 5 000`,  
- —Å–¥–µ–ª–∞–µ—Ç–µ `UPDATE STATISTICS` ‚Üí –∏ –ø–æ–ª—É—á–∏—Ç–µ **–≤ 50 —Ä–∞–∑ –º–µ–Ω—å—à–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è**.

> üí° –í—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É¬ª ‚Äî –≤—ã **—É–≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**, –∏ –ø–æ–π–º—ë—Ç–µ: *¬´–ê–≥–∞, –≤–æ—Ç –ø–æ—á–µ–º—É!¬ª*

---

üìé **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 1: –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**

```sql
-- 1. –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
SELECT 
    name AS StatName,
    STATS_DATE(object_id, stats_id) AS LastUpdate
FROM sys.stats 
WHERE object_id = OBJECT_ID('Orders');

-- 2. ¬´–ë–ª–æ–∫–Ω–æ—Ç–∏–∫¬ª (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)
DBCC SHOW_STATISTICS ('Orders', 'IX_Orders_Customer');
-- –í—ã–≤–æ–¥: 
--   - RANGE_HI_KEY (–≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞),
--   - EQ_ROWS (—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ = —ç—Ç–æ–π –≥—Ä–∞–Ω–∏—Ü–µ),
--   - RANGE_ROWS (—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞).
```

---

üìé **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 2: –¢–∏–ø–∏—á–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã —É—Å—Ç–∞—Ä–µ–≤—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**

| –°–∏–º–ø—Ç–æ–º | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `Index Seek` + **–º–Ω–æ–≥–æ Key Lookup‚Äô–æ–≤** | –û—Ü–µ–Ω–∫–∞ << —Ñ–∞–∫—Ç–∞ | `UPDATE STATISTICS` |
| `Index Scan` –≤–º–µ—Å—Ç–æ `Seek` | –û—Ü–µ–Ω–∫–∞ >> —Ñ–∞–∫—Ç–∞ | `UPDATE STATISTICS` |
| –ü–ª–∞–Ω –º–µ–Ω—è–µ—Ç—Å—è ¬´—Å–∞–º –ø–æ —Å–µ–±–µ¬ª | –°—Ä–∞–±–æ—Ç–∞–ª–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –£–≤–µ–ª–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| –ó–∞–ø—Ä–æ—Å —Ç–æ –±—ã—Å—Ç—Ä—ã–π, —Ç–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ | `UPDATE STATISTICS` –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥ –ø–∏–∫–æ–º |

---

üìú **–õ–∏—Ü–µ–Ω–∑–∏—è**: [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)  
üë®‚Äçüè´ **–ê–≤—Ç–æ—Ä**: –†—É—Å–ª–∞–Ω –†–∏–Ω–∞—Ç–æ–≤–∏—á –°–∞—Ñ–∏—É–ª–∏–Ω  
üìÖ **–î–∞—Ç–∞**: 15.11.2025  

---

### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR7.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR8.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ7](../LESSONS/PR7.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ8](../LESSONS/PR8.MD) |

---

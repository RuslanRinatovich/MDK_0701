### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR10.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR11.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ10](../LESSONS/PR10.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ11](../LESSONS/PR11.MD) |

# **–õ–µ–∫—Ü–∏—è 11. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã: sp_who2, sp_helpdb, sp_spaceused**

‚è±Ô∏è **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 90 –º–∏–Ω—É—Ç

üéØ **–¶–µ–ª—å –ª–µ–∫—Ü–∏–∏:**
–ü–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∫–∞–∫ ¬´—ç–∫—Å–ø—Ä–µ—Å—Å-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã¬ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞ 30 —Å–µ–∫—É–Ω–¥ –¥–∞—é—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã: ¬´–ö—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω?¬ª, ¬´–ß—Ç–æ —Å –±–∞–∑–∞–º–∏?¬ª, ¬´–ö—É–¥–∞ –ø—Ä–æ–ø–∞–ª–æ –º–µ—Å—Ç–æ?¬ª. –ù–∞—É—á–∏—Ç—å –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ DMV –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏.

### **üìñ –ß–∞—Å—Ç—å 0. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –∑–∞–ø–æ–º–Ω–∏—Ç–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞**

> **üí° –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã ‚Äî —ç—Ç–æ ¬´—à–æ—Ä—Ç–∫–∞—Ç—ã¬ª –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.**
>
> –ï—Å–ª–∏ DMV ‚Äî —ç—Ç–æ ¬´–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä¬ª —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, —Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã ‚Äî —ç—Ç–æ ¬´–≥–æ—Ç–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã¬ª –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–¥–∞—á.
>
> **–û–Ω–∏ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç DMV, –∞ –¥–æ–ø–æ–ª–Ω—è—é—Ç –∏—Ö** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, DMV ‚Äî –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã? –¢—Ä–∏ —É—Ä–æ–≤–Ω—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**

**üîπ –§–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**
–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã ‚Äî —ç—Ç–æ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤ SQL Server, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã.

**üîπ –ü—Ä–æ—Å—Ç–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**
–≠—Ç–æ ¬´–≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏¬ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≥–æ—Ç–æ–≤—É—é —Å–≤–æ–¥–∫—É –≤–º–µ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ DMV.

**‚úÖ –¢—Ä–∏ —É—Ä–æ–≤–Ω—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤ –∞—Ä—Å–µ–Ω–∞–ª–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**

| –£—Ä–æ–≤–µ–Ω—å | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü—Ä–∏–º–µ—Ä |
|---------|-------------|-------------------|---------|
| **1. –≠–∫—Å–ø—Ä–µ—Å—Å-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | `sp_who2` |
| **2. –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑** | DMV + —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è | –ì–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º | `sys.dm_exec_sessions` |
| **3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** | –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã + PowerShell | –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏, –æ—Ç—á–µ—Ç—ã | –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã |

### **2. –ì–ª–∞–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–¢–û–ü-10)**

**üñ•Ô∏è 1. `sp_who2` ‚Äî –∫—Ç–æ –∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ?**

```sql
-- –ë–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º–∞
EXEC sp_who2;

-- –° —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
EXEC sp_who2 'active';  -- –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
EXEC sp_who2 55;        -- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π SPID
```

**üí° –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `sp_who2`:**
- **SPID** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞
- **Status** ‚Äî —Å—Ç–∞—Ç—É—Å (running, sleeping, suspended)
- **Login** ‚Äî —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å
- **HostName** ‚Äî –∫–æ–º–ø—å—é—Ç–µ—Ä-–∏—Å—Ç–æ—á–Ω–∏–∫
- **BlkBy** ‚Äî –∫–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
- **DBName** ‚Äî —Ç–µ–∫—É—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Command** ‚Äî —Ç–∏–ø –∫–æ–º–∞–Ω–¥—ã
- **CPUTime** ‚Äî –≤—Ä–µ–º—è CPU
- **DiskIO** ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞
- **LastBatch** ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã
- **ProgramName** ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å DMV-–∞–Ω–∞–ª–æ–≥–æ–º:**
```sql
-- sp_who2 (1 –∫–æ–º–∞–Ω–¥–∞)
EXEC sp_who2;

-- –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç –Ω–∞ DMV (8+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)
SELECT 
    s.session_id, s.login_name, s.host_name,
    r.status, r.command, r.blocking_session_id,
    DB_NAME(r.database_id) as database_name,
    r.cpu_time, r.reads, r.writes,
    s.program_name, s.last_request_end_time
FROM sys.dm_exec_sessions s
LEFT JOIN sys.dm_exec_requests r ON s.session_id = r.session_id
WHERE s.is_user_process = 1;
```

**üñ•Ô∏è 2. `sp_helpdb` ‚Äî —á—Ç–æ —Å –º–æ–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö?**

```sql
-- –í—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
EXEC sp_helpdb;

-- –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –±–∞–∑–∞
EXEC sp_helpdb 'MonitorLab';
```

**üí° –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `sp_helpdb`:**
- **name** ‚Äî –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **db_size** ‚Äî –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
- **owner** ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü
- **dbid** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ë–î
- **created** ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- **status** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã
- **compatibility_level** ‚Äî —É—Ä–æ–≤–µ–Ω—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

**üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ë–î:**
- –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö (.mdf) –∏ –∏—Ö —Ä–∞–∑–º–µ—Ä—ã
- –§–∞–π–ª—ã –∂—É—Ä–Ω–∞–ª–∞ (.ldf) –∏ –∏—Ö —Ä–∞–∑–º–µ—Ä—ã
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–æ—Å—Ç–∞

**üñ•Ô∏è 3. `sp_spaceused` ‚Äî –∫—É–¥–∞ –ø—Ä–æ–ø–∞–ª–æ –º–µ—Å—Ç–æ?**

```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞–∑–µ
EXEC sp_spaceused;

-- –ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
EXEC sp_spaceused 'sales.Orders';

-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
EXEC sp_spaceused @updateusage = true;
```

**üí° –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `sp_spaceused`:**
- **database_size** ‚Äî –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ë–î
- **unallocated space** ‚Äî –Ω–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- **reserved** ‚Äî –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
- **data** ‚Äî —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
- **index_size** ‚Äî —Ä–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤
- **unused** ‚Äî –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ

**üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `sp_spaceused`:**
```sql
-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–æ—Å—Ç–∞ —Ç–∞–±–ª–∏—Ü
EXEC sp_spaceused 'sales.Orders';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: reserved = 1024 KB, data = 768 KB, index_size = 200 KB, unused = 56 KB

-- –ü–æ—Å–ª–µ –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏
EXEC sp_spaceused 'sales.Orders';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: reserved = 2048 KB, data = 1600 KB, index_size = 350 KB, unused = 98 KB
```

### **3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã**

**üõ†Ô∏è 4. `sp_lock` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö**

```sql
-- –í—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
EXEC sp_lock;

-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ SPID
EXEC sp_lock 55;
```

**üõ†Ô∏è 5. `sp_help` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ**

```sql
-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–µ
EXEC sp_help 'sales.Orders';

-- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: —Å—Ç–æ–ª–±—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–ª—é—á–∏
```

**üõ†Ô∏è 6. `sp_helptext` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞**

```sql
-- –¢–µ–∫—Å—Ç —Ö—Ä–∞–Ω–∏–º–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
EXEC sp_helptext 'sp_who2';

-- –¢–µ–∫—Å—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
EXEC sp_helptext 'sys.dm_exec_sessions';
```

**üõ†Ô∏è 7. `sp_configure` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞**

```sql
-- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
EXEC sp_configure;

-- –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
EXEC sp_configure 'max server memory';
```

### **4. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑: –ø—Ä–æ—Ü–µ–¥—É—Ä—ã vs DMV**

**üìä –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–æ–≤:**

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã | DMV |
|----------|---------------------|-----|
| **–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è** | ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ (1 –∫–æ–º–∞–Ω–¥–∞) | ‚ùå –¢—Ä–µ–±—É—é—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ |
| **–ì–∏–±–∫–æ—Å—Ç—å** | ‚ùå –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç | ‚úÖ –ü–æ–ª–Ω–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è |
| **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** | ‚ùå –û–±—â–∞—è —Å–≤–æ–¥–∫–∞ | ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |
| **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| **–û–±—É—á–µ–Ω–∏–µ** | ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | ‚ùå –¢—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è T-SQL |
| **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** | ‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤ | ‚úÖ –õ–µ–≥–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å |

**üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- **–ü–µ—Ä–≤–∏—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º**
- **–û–±—É—á–µ–Ω–∏–µ –Ω–æ–≤–∏—á–∫–æ–≤**
- **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–ª–ª–µ–≥–∞–º/—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É**

**üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DMV:**
- **–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
- **–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤**
- **–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤**

### **5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

**üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 1: ¬´–°–µ—Ä–≤–µ—Ä —Ç–æ—Ä–º–æ–∑–∏—Ç¬ª ‚Äî –±—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞ 60 —Å–µ–∫—É–Ω–¥**

```sql
-- –®–∞–≥ 1: –ö—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç?
EXEC sp_who2 'active';

-- –®–∞–≥ 2: –ï—Å—Ç—å –ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏?
EXEC sp_lock;

-- –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ –ë–î
EXEC sp_helpdb;
```

**üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 2: ¬´–ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ¬ª ‚Äî –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

```sql
-- –®–∞–≥ 1: –†–∞–∑–º–µ—Ä—ã –≤—Å–µ—Ö –ë–î
EXEC sp_helpdb;

-- –®–∞–≥ 2: –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –ë–î
USE ProblemDB;
EXEC sp_spaceused;

-- –®–∞–≥ 3: –ö—Ä—É–ø–Ω–µ–π—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã
EXEC sp_spaceused 'BigTable1';
EXEC sp_spaceused 'BigTable2';
```

**üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 3: ¬´–ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞¬ª ‚Äî –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**

```sql
-- –®–∞–≥ 1: –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ CPU
EXEC sp_who2 'active';

-- –®–∞–≥ 2: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–±–ª–µ–º–Ω–æ–º SPID
EXEC sp_lock 67;  -- SPID –∏–∑ —à–∞–≥–∞ 1

-- –®–∞–≥ 3: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
EXEC sp_who2;
```

### **6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**

**‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä:**

1. **`sp_who2` ‚Äî –ù–ï–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞**
   - –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö
   - –ù–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è

2. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞**
   - –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
   - –°–ª–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö

3. **–ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
   - –ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**üîß –†–µ—à–µ–Ω–∏–µ: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä-–æ–±–µ—Ä—Ç–æ–∫**

```sql
CREATE PROCEDURE dbo.usp_QuickDiagnostics
AS
BEGIN
    PRINT '=== –ê–ö–¢–ò–í–ù–´–ï –°–ï–°–°–ò–ò ===';
    EXEC sp_who2 'active';
    
    PRINT '=== –†–ê–ó–ú–ï–†–´ –ë–ê–ó –î–ê–ù–ù–´–• ===';
    EXEC sp_helpdb;
    
    PRINT '=== –ë–õ–û–ö–ò–†–û–í–ö–ò ===';
    EXEC sp_lock;
END
GO

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
EXEC dbo.usp_QuickDiagnostics;
```

### **7. –ú–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ—Ü–µ–¥—É—Ä –Ω–∞ DMV**

**üìù –®–∞–±–ª–æ–Ω—ã –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**

```sql
-- –í–º–µ—Å—Ç–æ sp_who2
CREATE VIEW dbo.vw_CustomWho
AS
SELECT 
    s.session_id AS SPID,
    s.login_name AS Login,
    s.host_name AS HostName,
    r.status AS Status,
    DB_NAME(r.database_id) AS DBName,
    r.command AS Command,
    r.cpu_time AS CPUTime,
    r.total_elapsed_time AS Time,
    r.blocking_session_id AS BlkBy,
    s.program_name AS ProgramName
FROM sys.dm_exec_sessions s
LEFT JOIN sys.dm_exec_requests r ON s.session_id = r.session_id
WHERE s.is_user_process = 1;

-- –í–º–µ—Å—Ç–æ sp_helpdb
CREATE VIEW dbo.vw_CustomDBInfo
AS
SELECT 
    name,
    database_id,
    state_desc,
    recovery_model_desc,
    compatibility_level,
    size/128.0 AS SizeMB
FROM sys.databases;
```

### **8. –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏**

1. **–í —á–µ–º –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ `sp_who2` –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ `sys.dm_exec_sessions`?**
   ‚Üí –°–∫–æ—Ä–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ‚Äî –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

2. **–ü–æ—á–µ–º—É `sp_who2` —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π?**
   ‚Üí Microsoft –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –µ–µ —Ä–∞–±–æ—Ç—É –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö SQL Server.

3. **–ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä–æ–π –±—ã—Å—Ç—Ä–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –º–µ—Å—Ç–∞?**
   ‚Üí `sp_spaceused` —Å –∏–º–µ–Ω–µ–º —Ç–∞–±–ª–∏—Ü—ã.

4. **–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `BlkBy` –≤ `sp_who2`?**
   ‚Üí ID —Å–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é.

5. **–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?**
   ‚Üí `EXEC sp_helpdb 'DatabaseName'` –ø–æ–∫–∞–∂–µ—Ç —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∂—É—Ä–Ω–∞–ª–æ–≤.

### **9. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ ‚Äî 5 –∫–ª—é—á–µ–≤—ã—Ö –º—ã—Å–ª–µ–π**

1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã ‚Äî ¬´—Å–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å¬ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
2. **`sp_who2` + `sp_helpdb` + `sp_spaceused` = –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å**.
3. **–ü—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç DMV, –∞ –¥–æ–ø–æ–ª–Ω—è—é—Ç –∏—Ö** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞.
4. **–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã-–æ–±–µ—Ä—Ç–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ DMV.
5. **–ó–Ω–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä —É—Å–∫–æ—Ä—è–µ—Ç —Ä—É—Ç–∏–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ 10 —Ä–∞–∑**.

**üîú –ß—Ç–æ –¥–∞–ª—å—à–µ?**
–í –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ11 –≤—ã:
- –°—Ä–∞–≤–Ω–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏ –∏ DMV
- –°–æ–∑–¥–∞–¥–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ù–∞—É—á–∏—Ç–µ—Å—å –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–º–æ—â—å—é ¬´–∑–æ–ª–æ—Ç–æ–π —Ç—Ä–æ–π–∫–∏¬ª –ø—Ä–æ—Ü–µ–¥—É—Ä

üìé **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º**

| –ó–∞–¥–∞—á–∞ | –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ | DMV-–∞–Ω–∞–ª–æ–≥ |
|--------|-----------|------------|
| –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | `sp_who2` | `sys.dm_exec_sessions` + `sys.dm_exec_requests` |
| –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ë–î | `sp_helpdb` | `sys.databases` + `sys.master_files` |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ | `sp_spaceused` | `sys.dm_db_partition_stats` |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ | `sp_lock` | `sys.dm_tran_locks` |
| –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ | `sp_help` | `sys.objects` + `sys.columns` + `sys.indexes` |

---

### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR10.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR11.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ10](../LESSONS/PR10.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ11](../LESSONS/PR11.MD) |

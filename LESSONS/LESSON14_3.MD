### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR13_2.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR13_3.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ13.2](../LESSONS/PR13_2.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ13.3](../LESSONS/PR13_3.MD) |

---
# **–õ–µ–∫—Ü–∏—è 13.3. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä**


‚è±Ô∏è **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 90 –º–∏–Ω—É—Ç

---

## **üìñ –ß–∞—Å—Ç—å 1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏**

### **üîπ –ß—Ç–æ –º—ã —É–∂–µ —É–º–µ–µ–º?**
1. –°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å PRINT –∏ SELECT
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (DECLARE, SET)
3. –†–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–≤—Ö–æ–¥–Ω—ã–µ, OUTPUT)
4. –ü—Ä–∏–º–µ–Ω—è—Ç—å SET NOCOUNT ON

### **üîπ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–µ–º —Å–µ–≥–æ–¥–Ω—è?**
1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ "–Ω–∞ –ª–µ—Ç—É"
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî TRY...CATCH –±–ª–æ–∫–∏  
3. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∞–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä—ã** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

---

## **üìñ –ß–∞—Å—Ç—å 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL**

### **üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL?**
–≠—Ç–æ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ–¥—É—Ä—ã.

### **üîπ –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL?**
1. –ö–æ–≥–¥–∞ –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –∏–ª–∏ –±–∞–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ
2. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–∏–±–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —É—Å–ª–æ–≤–∏–π
3. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### **üîπ –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ SQL:**
```sql
CREATE PROCEDURE usp_SimpleDynamic
    @TableName NVARCHAR(100)
AS
BEGIN
    SET NOCOUNT ON;
    
    -- –°–æ–∑–¥–∞–µ–º SQL –∑–∞–ø—Ä–æ—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    DECLARE @SQL NVARCHAR(MAX);
    SET @SQL = 'SELECT TOP 10 * FROM ' + @TableName;
    
    -- –í—ã–ø–æ–ª–Ω—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL
    PRINT '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å: ' + @SQL;
    EXEC sp_executesql @SQL;
END
GO

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
EXEC usp_SimpleDynamic @TableName = 'sys.databases';
EXEC usp_SimpleDynamic @TableName = 'sys.tables';
```

### **üîπ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL:**
```sql
CREATE PROCEDURE usp_SafeDynamic
    @DatabaseName NVARCHAR(100)
AS
BEGIN
    SET NOCOUNT ON;
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
    IF NOT EXISTS (SELECT 1 FROM sys.databases WHERE name = @DatabaseName)
    BEGIN
        PRINT '–û—à–∏–±–∫–∞: –±–∞–∑–∞ ' + @DatabaseName + ' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
        RETURN;
    END
    
    -- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å QUOTENAME
    DECLARE @SQL NVARCHAR(MAX);
    SET @SQL = 'USE ' + QUOTENAME(@DatabaseName) + ';
               SELECT COUNT(*) AS TableCount FROM sys.tables';
    
    -- –í—ã–ø–æ–ª–Ω—è–µ–º
    EXEC sp_executesql @SQL;
END
GO
```

### **üîπ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:**
```sql
CREATE PROCEDURE usp_DynamicWithParams
    @MinRows INT = 0
AS
BEGIN
    SET NOCOUNT ON;
    
    DECLARE @SQL NVARCHAR(MAX);
    DECLARE @Params NVARCHAR(MAX);
    
    -- SQL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
    SET @SQL = '
        SELECT name, 
               (SELECT SUM(rows) FROM sys.partitions 
                WHERE object_id = t.object_id) AS RowCount
        FROM sys.tables t
        WHERE (SELECT SUM(rows) FROM sys.partitions 
               WHERE object_id = t.object_id) >= @MinRowsParam
        ORDER BY RowCount DESC';
    
    -- –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    SET @Params = '@MinRowsParam INT';
    
    -- –í—ã–ø–æ–ª–Ω—è–µ–º —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    EXEC sp_executesql @SQL, @Params, @MinRowsParam = @MinRows;
END
GO
```

---

## **üìñ –ß–∞—Å—Ç—å 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ TRY...CATCH**

### **üîπ –ó–∞—á–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏?**
1. –ß—Ç–æ–±—ã –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –Ω–µ –ø–∞–¥–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
2. –ß—Ç–æ–±—ã –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∂—É—Ä–Ω–∞–ª
3. –ß—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
4. –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

### **üîπ –ë–ª–æ–∫ TRY...CATCH:**
```sql
BEGIN TRY
    -- –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É
    -- –ù–∞–ø—Ä–∏–º–µ—Ä: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å, –Ω–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
END TRY
BEGIN CATCH
    -- –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
    -- –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
END CATCH
```

### **üîπ –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**
```sql
CREATE PROCEDURE usp_SafeDivision
    @A INT,
    @B INT
AS
BEGIN
    SET NOCOUNT ON;
    
    BEGIN TRY
        -- –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–ª–µ–Ω–∏–µ
        DECLARE @Result DECIMAL(10,2);
        SET @Result = @A * 1.0 / @B;
        
        PRINT '–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–ª–µ–Ω–∏—è: ' + CAST(@Result AS VARCHAR);
    END TRY
    BEGIN CATCH
        -- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
        PRINT '–û–®–ò–ë–ö–ê! –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–ª–µ–Ω–∏–µ';
        PRINT '–ö–æ–¥ –æ—à–∏–±–∫–∏: ' + CAST(ERROR_NUMBER() AS VARCHAR);
        PRINT '–°–æ–æ–±—â–µ–Ω–∏–µ: ' + ERROR_MESSAGE();
        PRINT '–°—Ç—Ä–æ–∫–∞ —Å –æ—à–∏–±–∫–æ–π: ' + CAST(ERROR_LINE() AS VARCHAR);
    END CATCH
END
GO

-- –¢–µ—Å—Ç–∏—Ä—É–µ–º:
EXEC usp_SafeDivision @A = 10, @B = 2;  -- –†–∞–±–æ—Ç–∞–µ—Ç
EXEC usp_SafeDivision @A = 10, @B = 0;  -- –û—à–∏–±–∫–∞, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ—Ç
```

### **üîπ –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏:**
```sql
-- –í –±–ª–æ–∫–µ CATCH –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
ERROR_NUMBER()      -- –ù–æ–º–µ—Ä –æ—à–∏–±–∫–∏
ERROR_MESSAGE()     -- –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
ERROR_SEVERITY()    -- –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å (10-25)
ERROR_STATE()       -- –°–æ—Å—Ç–æ—è–Ω–∏–µ
ERROR_LINE()        -- –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–æ–π
ERROR_PROCEDURE()   -- –ò–º—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –≥–¥–µ –æ—à–∏–±–∫–∞
```

### **üîπ –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫:**
```sql
CREATE PROCEDURE usp_ComplexProcedure
    @DatabaseName NVARCHAR(100)
AS
BEGIN
    SET NOCOUNT ON;
    
    DECLARE @StartTime DATETIME = GETDATE();
    DECLARE @ErrorNumber INT = 0;
    DECLARE @ErrorMessage NVARCHAR(4000);
    
    BEGIN TRY
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
        IF NOT EXISTS (SELECT 1 FROM sys.databases WHERE name = @DatabaseName)
            RAISERROR('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 16, 1);
        
        -- –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–∑–µ
        DECLARE @SQL NVARCHAR(MAX);
        SET @SQL = 'USE ' + QUOTENAME(@DatabaseName) + ';
                   SELECT COUNT(*) FROM sys.tables';
        
        -- –í—ã–ø–æ–ª–Ω—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL
        EXEC sp_executesql @SQL;
        
        PRINT '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞ ' + 
              CAST(DATEDIFF(MILLISECOND, @StartTime, GETDATE()) AS VARCHAR) + ' –º—Å';
    END TRY
    BEGIN CATCH
        -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
        SET @ErrorNumber = ERROR_NUMBER();
        SET @ErrorMessage = ERROR_MESSAGE();
        
        -- –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
        PRINT '–û–®–ò–ë–ö–ê –í –ü–†–û–¶–ï–î–£–†–ï usp_ComplexProcedure';
        PRINT '–í—Ä–µ–º—è: ' + CONVERT(VARCHAR, GETDATE(), 120);
        PRINT '–ë–∞–∑–∞: ' + @DatabaseName;
        PRINT '–ö–æ–¥ –æ—à–∏–±–∫–∏: ' + CAST(@ErrorNumber AS VARCHAR);
        PRINT '–°–æ–æ–±—â–µ–Ω–∏–µ: ' + @ErrorMessage;
        
        -- –ú–æ–∂–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É
        -- INSERT INTO ErrorLog (ErrorTime, ProcedureName, ErrorMessage)
        -- VALUES (GETDATE(), 'usp_ComplexProcedure', @ErrorMessage);
        
        -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–¥ –æ—à–∏–±–∫–∏
        RETURN @ErrorNumber;
    END CATCH
    
    RETURN 0;  -- –£—Å–ø–µ—Ö
END
GO
```

---

## **üìñ –ß–∞—Å—Ç—å 4. –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö**

### **üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã?**
–¢–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã.

### **üîπ –î–≤–∞ —Ç–∏–ø–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:**

1. **–õ–æ–∫–∞–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #)
   ```sql
   CREATE TABLE #TempTable (
       ID INT,
       Name NVARCHAR(100)
   );
   -- –°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
   -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   ```

2. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å ##)
   ```sql
   CREATE TABLE ##GlobalTemp (
       ID INT
   );
   -- –í–∏–¥–Ω—ã –≤—Å–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º
   -- –£–¥–∞–ª—è—é—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∞—é—â–∏–µ—Å—è –Ω–∞ –Ω–∏—Ö –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
   ```

### **üîπ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:**
```sql
CREATE PROCEDURE usp_UseTempTable
AS
BEGIN
    SET NOCOUNT ON;
    
    -- –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    CREATE TABLE #DatabaseInfo (
        DatabaseName NVARCHAR(100),
        TableCount INT,
        SizeMB DECIMAL(10,2)
    );
    
    -- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
    INSERT INTO #DatabaseInfo (DatabaseName, TableCount, SizeMB)
    SELECT 
        d.name,
        (SELECT COUNT(*) FROM sys.tables WHERE is_ms_shipped = 0),
        (SELECT CAST(SUM(size) * 8 / 1024.0 AS DECIMAL(10,2))
         FROM sys.master_files WHERE database_id = d.database_id)
    FROM sys.databases d
    WHERE d.state = 0;
    
    -- –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    PRINT '=== –û–¢–ß–ï–¢ –ü–û –ë–ê–ó–ê–ú –î–ê–ù–ù–´–• ===';
    SELECT * FROM #DatabaseInfo ORDER BY SizeMB DESC;
    
    -- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º
    DECLARE @TotalSize DECIMAL(10,2);
    SELECT @TotalSize = SUM(SizeMB) FROM #DatabaseInfo;
    PRINT '–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—Å–µ—Ö –±–∞–∑: ' + CAST(@TotalSize AS VARCHAR) + ' –ú–ë';
    
    -- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    -- –ù–æ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —è–≤–Ω–æ:
    -- DROP TABLE #DatabaseInfo;
END
GO
```

### **üîπ –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º:**
```sql
CREATE PROCEDURE usp_TempTableWithIndex
AS
BEGIN
    SET NOCOUNT ON;
    
    -- –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    CREATE TABLE #LargeTables (
        TableID INT IDENTITY PRIMARY KEY,
        SchemaName NVARCHAR(100),
        TableName NVARCHAR(100),
        RowCount BIGINT,
        SizeMB DECIMAL(10,2)
    );
    
    -- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    CREATE INDEX IX_Size ON #LargeTables(SizeMB DESC);
    
    -- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
    INSERT INTO #LargeTables (SchemaName, TableName, RowCount, SizeMB)
    SELECT 
        s.name,
        t.name,
        SUM(p.rows),
        CAST(SUM(a.total_pages) * 8 / 1024.0 AS DECIMAL(10,2))
    FROM sys.tables t
    JOIN sys.schemas s ON t.schema_id = s.schema_id
    JOIN sys.partitions p ON t.object_id = p.object_id
    JOIN sys.allocation_units a ON p.partition_id = a.container_id
    WHERE t.is_ms_shipped = 0
    GROUP BY s.name, t.name;
    
    -- –ò—Å–ø–æ–ª—å–∑—É–µ–º
    SELECT TOP 10 * FROM #LargeTables ORDER BY SizeMB DESC;
    
    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    PRINT '–í—Å–µ–≥–æ —Ç–∞–±–ª–∏—Ü –≤ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ: ' + 
          CAST(@@ROWCOUNT AS VARCHAR);
END
GO
```

---

## **üìñ –ß–∞—Å—Ç—å 5. –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**

### **üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–∞–±–ª–∏—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è?**
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏.

```sql
DECLARE @TableVar TABLE (
    ID INT,
    Name NVARCHAR(100),
    Age INT
);
```

### **üîπ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—á–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:**

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –¢–∞–±–ª–∏—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (@Table) | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (#Table) |
|----------|-------------------------------|----------------------------|
| **–•—Ä–∞–Ω–µ–Ω–∏–µ** | –í –ø–∞–º—è—Ç–∏ (–æ–±—ã—á–Ω–æ) | –ù–∞ –¥–∏—Å–∫–µ (tempdb) |
| **–ò–Ω–¥–µ–∫—Å—ã** | –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á | –õ—é–±—ã–µ –∏–Ω–¥–µ–∫—Å—ã |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | –ï—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| **–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö** | –ú–∞–ª–µ–Ω—å–∫–∏–µ –æ–±—ä–µ–º—ã | –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –ë—ã—Å—Ç—Ä–µ–µ –¥–ª—è –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö | –õ—É—á—à–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö |

### **üîπ –ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—á–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:**
```sql
CREATE PROCEDURE usp_UseTableVariable
AS
BEGIN
    SET NOCOUNT ON;
    
    -- –û–±—ä—è–≤–ª—è–µ–º —Ç–∞–±–ª–∏—á–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    DECLARE @UserInfo TABLE (
        UserID INT,
        UserName NVARCHAR(100),
        LoginTime DATETIME
    );
    
    -- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
    INSERT INTO @UserInfo (UserID, UserName, LoginTime)
    SELECT 
        session_id,
        login_name,
        login_time
    FROM sys.dm_exec_sessions
    WHERE is_user_process = 1;
    
    -- –ò—Å–ø–æ–ª—å–∑—É–µ–º
    SELECT * FROM @UserInfo ORDER BY LoginTime DESC;
    
    PRINT '–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + CAST(@@ROWCOUNT AS VARCHAR);
END
GO
```

---

## **üìñ –ß–∞—Å—Ç—å 6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∞–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä—ã**

### **üîπ –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π:**
```sql
CREATE PROCEDURE adm_CheckBackups
    @DaysBack INT = 7  -- –ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä—è—Ç—å
AS
BEGIN
    SET NOCOUNT ON;
    
    PRINT '–ü–†–û–í–ï–†–ö–ê –†–ï–ó–ï–†–í–ù–´–• –ö–û–ü–ò–ô';
    PRINT '=======================';
    PRINT '–ü–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ–¥–Ω–∏–µ ' + CAST(@DaysBack AS VARCHAR) + ' –¥–Ω–µ–π';
    PRINT '';
    
    -- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    CREATE TABLE #BackupInfo (
        DatabaseName NVARCHAR(100),
        LastBackup DATETIME,
        HoursAgo INT,
        Status NVARCHAR(20)
    );
    
    -- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
    INSERT INTO #BackupInfo (DatabaseName, LastBackup, HoursAgo, Status)
    SELECT 
        d.name,
        MAX(b.backup_finish_date),
        DATEDIFF(HOUR, MAX(b.backup_finish_date), GETDATE()),
        CASE 
            WHEN MAX(b.backup_finish_date) IS NULL THEN '–ù–ï–¢ –ö–û–ü–ò–ô'
            WHEN DATEDIFF(HOUR, MAX(b.backup_finish_date), GETDATE()) > 24 
            THEN '–°–¢–ê–†–ê–Ø'
            ELSE 'OK'
        END
    FROM sys.databases d
    LEFT JOIN msdb.dbo.backupset b ON d.name = b.database_name
        AND b.backup_finish_date > DATEADD(DAY, -@DaysBack, GETDATE())
    WHERE d.database_id > 4  -- –ù–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ
    GROUP BY d.name
    ORDER BY HoursAgo DESC;
    
    -- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    SELECT * FROM #BackupInfo;
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–±–ª–µ–º—ã
    PRINT '';
    DECLARE @ProblemCount INT;
    SELECT @ProblemCount = COUNT(*) 
    FROM #BackupInfo 
    WHERE Status IN ('–ù–ï–¢ –ö–û–ü–ò–ô', '–°–¢–ê–†–ê–Ø');
    
    IF @ProblemCount > 0
        PRINT '–í–ù–ò–ú–ê–ù–ò–ï! –ù–∞–π–¥–µ–Ω–æ ' + CAST(@ProblemCount AS VARCHAR) + 
              ' –±–∞–∑ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!';
    ELSE
        PRINT '–í—Å–µ –±–∞–∑—ã –∏–º–µ—é—Ç —Å–≤–µ–∂–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏.';
    
    DROP TABLE #BackupInfo;
END
GO
```

### **üîπ –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞:**
```sql
CREATE PROCEDURE adm_CheckDiskSpace
    @WarningGB INT = 10,   -- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ < 10 –ì–ë
    @CriticalGB INT = 5    -- –ö—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏ < 5 –ì–ë
AS
BEGIN
    SET NOCOUNT ON;
    
    -- –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    CREATE TABLE #DiskInfo (
        Drive CHAR(1),
        FreeMB INT
    );
    
    -- –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∏—Å–∫–∞—Ö
    INSERT INTO #DiskInfo
    EXEC xp_fixeddrives;
    
    -- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º
    PRINT '–ú–û–ù–ò–¢–û–†–ò–ù–ì –î–ò–°–ö–û–í–û–ì–û –ü–†–û–°–¢–†–ê–ù–°–¢–í–ê';
    PRINT '=================================';
    PRINT '';
    
    SELECT 
        Drive AS '–î–∏—Å–∫',
        FreeMB / 1024 AS '–°–≤–æ–±–æ–¥–Ω–æ (–ì–ë)',
        CASE 
            WHEN FreeMB / 1024 < @CriticalGB THEN '–ö–†–ò–¢–ò–ß–ï–°–ö–ò'
            WHEN FreeMB / 1024 < @WarningGB THEN '–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï'
            ELSE '–ù–û–†–ú–ê'
        END AS '–°—Ç–∞—Ç—É—Å'
    FROM #DiskInfo
    ORDER BY Drive;
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å—ã
    DECLARE @CriticalCount INT, @WarningCount INT;
    
    SELECT @CriticalCount = COUNT(*)
    FROM #DiskInfo
    WHERE FreeMB / 1024 < @CriticalGB;
    
    SELECT @WarningCount = COUNT(*)
    FROM #DiskInfo
    WHERE FreeMB / 1024 < @WarningGB AND FreeMB / 1024 >= @CriticalGB;
    
    PRINT '';
    PRINT '–ò–¢–û–ì–û:';
    PRINT '–î–∏—Å–∫–æ–≤ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏: ' + CAST(@CriticalCount AS VARCHAR);
    PRINT '–î–∏—Å–∫–æ–≤ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º: ' + CAST(@WarningCount AS VARCHAR);
    
    -- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    PRINT '';
    PRINT '–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:';
    IF @CriticalCount > 0
        PRINT '  –°–†–û–ß–ù–û –æ—Å–≤–æ–±–æ–¥–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å–∫–∞—Ö!';
    IF @WarningCount > 0
        PRINT '  –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –¥–∏—Å–∫–∏ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º';
    IF @CriticalCount = 0 AND @WarningCount = 0
        PRINT '  –í—Å–µ –¥–∏—Å–∫–∏ –≤ –Ω–æ—Ä–º–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥';
    
    DROP TABLE #DiskInfo;
END
GO
```

### **üîπ –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø–æ–∏—Å–∫–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü:**
```sql
CREATE PROCEDURE adm_FindLargeObjects
    @DatabaseName NVARCHAR(100) = NULL,
    @MinSizeMB INT = 100,
    @ObjectType VARCHAR(20) = 'ALL'
AS
BEGIN
    SET NOCOUNT ON;
    
    DECLARE @SQL NVARCHAR(MAX);
    
    -- –ï—Å–ª–∏ –ë–î –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é
    IF @DatabaseName IS NULL
        SET @DatabaseName = DB_NAME();
    
    PRINT '–ü–û–ò–°–ö –ë–û–õ–¨–®–ò–• –û–ë–™–ï–ö–¢–û–í';
    PRINT '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ' + @DatabaseName;
    PRINT '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ' + CAST(@MinSizeMB AS VARCHAR) + ' –ú–ë';
    PRINT '';
    
    BEGIN TRY
        SET @SQL = '
        USE [' + @DatabaseName + '];
        
        WITH ObjectSizes AS (
            SELECT 
                s.name AS SchemaName,
                o.name AS ObjectName,
                o.type_desc AS ObjectType,
                SUM(a.total_pages) * 8 / 1024.0 AS SizeMB
            FROM sys.objects o
            JOIN sys.schemas s ON o.schema_id = s.schema_id
            JOIN sys.partitions p ON o.object_id = p.object_id
            JOIN sys.allocation_units a ON p.partition_id = a.container_id
            WHERE o.is_ms_shipped = 0
            AND (@ObjectTypeParam = ''ALL'' OR o.type_desc = @ObjectTypeParam)
            GROUP BY s.name, o.name, o.type_desc
        )
        SELECT *
        FROM ObjectSizes
        WHERE SizeMB >= @MinSizeParam
        ORDER BY SizeMB DESC;';
        
        EXEC sp_executesql @SQL, 
            N'@MinSizeParam INT, @ObjectTypeParam VARCHAR(20)',
            @MinSizeParam = @MinSizeMB,
            @ObjectTypeParam = @ObjectType;
        
        PRINT '';
        PRINT '–ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ';
    END TRY
    BEGIN CATCH
        PRINT '–û–®–ò–ë–ö–ê –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤:';
        PRINT ERROR_MESSAGE();
        PRINT '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã';
    END CATCH
END
GO
```

---

## **üìñ –ß–∞—Å—Ç—å 7. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏**

### **üîπ 1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SET NOCOUNT ON**
```sql
CREATE PROCEDURE usp_GoodProcedure
AS
BEGIN
    SET NOCOUNT ON;  -- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞!
    -- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥...
END
```

### **üîπ 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏**
```sql
CREATE PROCEDURE usp_SafeProcedure
AS
BEGIN
    SET NOCOUNT ON;
    
    BEGIN TRY
        -- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
    END TRY
    BEGIN CATCH
        -- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        PRINT '–û—à–∏–±–∫–∞: ' + ERROR_MESSAGE();
        RETURN -1;
    END CATCH
END
```

### **üîπ 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
```sql
-- –í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
CREATE TABLE #TempResults (...);
INSERT INTO #TempResults SELECT ...;
-- –†–∞–±–æ—Ç–∞–π—Ç–µ —Å #TempResults
```

### **üîπ 4. –ö–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É**
```sql
-- –•–æ—Ä–æ—à–æ:
-- –≠—Ç–æ—Ç –±–ª–æ–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
-- –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
DECLARE @AvgSizeMB DECIMAL(10,2);
SELECT @AvgSizeMB = AVG(SizeMB) FROM #TableSizes;

-- –ü–ª–æ—Ö–æ:
DECLARE @x DECIMAL(10,2);
SELECT @x = AVG(s) FROM #t;
```

### **üîπ 5. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**
```sql
-- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É —Å:
EXEC usp_Test @Param = NULL;      -- NULL –∑–Ω–∞—á–µ–Ω–∏—è
EXEC usp_Test @Param = '';        -- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏  
EXEC usp_Test @Param = 0;         -- –ù—É–ª–∏
EXEC usp_Test @Param = -1;        -- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```

---

## **üìã –®–ø–∞—Ä–≥–∞–ª–∫–∞: –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

| –°–∏—Ç—É–∞—Ü–∏—è | –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü—Ä–∏–º–µ—Ä |
|----------|------------------|--------|
| **–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å** | –û–±—ã—á–Ω—ã–π SELECT | `SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞` |
| **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã** | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL | `EXEC sp_executesql @SQL` |
| **–û–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** | TRY...CATCH | `BEGIN TRY...END TRY` |
| **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** | –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ | `CREATE TABLE #Temp` |
| **–ú–∞–ª–µ–Ω—å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏** | –¢–∞–±–ª–∏—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è | `DECLARE @Table TABLE` |
| **–°–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** | –ù–µ—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü | –†–∞–∑–±–∏—Ç—å –Ω–∞ —à–∞–≥–∏ |

---

## **üéØ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**

### **‚úÖ 5 –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å:**

1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL** ‚Äî –¥–ª—è –≥–∏–±–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤
2. **TRY...CATCH** ‚Äî –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–ª–∞–¥–∫–∏
3. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (#)** ‚Äî –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **–¢–∞–±–ª–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (@)** ‚Äî –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
5. **SET NOCOUNT ON –≤—Å–µ–≥–¥–∞** ‚Äî –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–∞–∂–¥–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

### **‚ùå 5 —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫:**

1. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫** –≤ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ SQL –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏** ‚Äî —Ä–∏—Å–∫ SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
3. **–ë–æ–ª—å—à–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** ‚Äî –ª—É—á—à–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
4. **–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** –≤ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–µ
5. **–ó–∞–±—ã–≤–∞—é—Ç —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** ‚Äî —Ö–æ—Ç—è –æ–Ω–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## **üìö –†–µ–∑—é–º–µ**

–°–µ–≥–æ–¥–Ω—è –≤—ã —É–∑–Ω–∞–ª–∏:
1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. **–û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** ‚Äî –∫–∞–∫ –¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —É—Å—Ç–æ–π—á–∏–≤—ã–º–∏ –∫ —Å–±–æ—è–º
3. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** ‚Äî –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –∞–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü–æ–º–Ω–∏—Ç–µ:** –•–æ—Ä–æ—à–∞—è –∞–¥–º–∏–Ω-–ø—Ä–æ—Ü–µ–¥—É—Ä–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—á–∞—è, –Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∞—è –æ—à–∏–±–∫–∏ –∏ —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è!

---

### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–∞–∫—Ç–∏–∫–∞ 13.2](../PRACT

---

### üîô üìö üîú –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫—É—Ä—Å—É

| [–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR13_2.MD) | &nbsp; | [–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ](../LESSONS/PR13_3.MD) |
|:--------------------------------------:|:------:|:-------------------------------------:|
| üè† [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ13.2](../LESSONS/PR13_2.MD) | üìñ [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](../README.MD) | üíª [–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Ññ13.3](../LESSONS/PR13_3.MD) |

---
